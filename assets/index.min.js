const t=""+new URL("out_0-x3uqDH9O.png",import.meta.url).href,i=[{n:"Level_0",w:82,t:34,i:"AQSHAEkwSjBLMFEwAjRJNEo0SzRRNFE4UTxRQFFEUUgETAVMBkwHTAhMCUwKTAtMFEwVTBZMF0wYTB9MIEwhTCJMI0wkTCVMJkxRTARQBVAGUAdQCFAJUApQC1BRUARUBVQGVAdUCFQJVApUC1RRVFFYUVwYcBd0GHQWeBd4GHgqeBV8FnwXfBh8O3w8fD18PnwUgBWAFoAXgBiAGYAagBuAHIAdgB6AH4AggCGAIoAjgCSAJYAmgCeAKIA7gACEAYQChAOEBIQFhAaEB4QIhAmECoQLhAyEDYQOhA+EEIQRhBKEE4QUhBWEFoQXhBiEGYQahBuEHIQdhB6EH4QghCGEIoQjhCSEJYQmhCeEKIQ7hAAQBAAvfDN8Nnw6fAEQBwA/bCp8MHw0fDd8KYA8gAEMBAA/aCt4NHgZfAAMDAACMEg0UFwXcBZ0KnQVeDN4PngUfCl8E4AABCUASDBQMAE0UDRQOD48UDw+QFBAPkRQRD5IUEgDTBNMHkw+TFBMA1A+UFBQA1Q+VFBUPlhQWD5cPmA+ZD5oPmw+cDN0PnQpeDqAOoQBCFwACCwJLAosCywMLA0sDiwPLBAsFywYLBksGiwbLBwsHSweLB8sICwhLCgsKSwqLCssLCw0LDUsNiw3LDgsAjgDOEI4QzhEOEU4RjhHOEg4SThKOEs4FFAVUBZQF1AYUB9QIFAhUCJQI1AkUCVQJlAEWAVYBlgHWAhYCVgKWAtYSGBJYEpgS2BMYE1gTmBPYFBgUWAvaEBsQWxCbCt8LHwtfC58MXwyfDV8OHw5fE18TnxPfFB8PYA+gAIEHwADMEwwAzRMND88P0A/RD9IDEwZTCdMP0wMUD9QDFQ/VD9YP1w/YD9kGXA/cBl0K3Q0dD90GXg/eD98KYQ8hAEAfgAIKAkoCigLKAwoDSgOKA8oECgXKBgoGSgaKBsoHCgdKB4oHyggKCEoKCgpKCooKygsKDQoNSg2KDcoOChJLEosSyxRLEM0RDRFNEY0RzQ/OARIBUgGSAdICEgJSApIC0gUSBVIFkgXSBhIH0ggSCFIIkgjSCRIJUgmSEhcSVxKXEtcTFxNXE5cT1wvZEBoQWhCaBhsLHgteC54L3gweDF4Mng1eDZ4N3g4eDl4Ong7eDx4PXhOeE94GnwbfBx8HXwefB98IHwhfCJ8I3wkfCV8JnwnfCh8AIABgAKAA4AEgAWABoAHgAiACYAKgAuADIANgA6AD4AQgBGAEoAACA0ABywWLCcsMywBOBNQHlADWEdgLmgvgDOANoACCA8AESwiLC0sOSxMOBlQJ1AMWDBoQ2wqgDCANIA3gD+AAgAPABEoIigtKDkoAyxMLAxIGUgnSDBkQ2gZbCtwNHBQeAAAGAAHKBYoJygzKAIsSCxQLAEwQjQ+OANIE0geSEdcLmQXbBZwKnAzcBV0KXQUeE14E3wEAA4ABDhAOEE4H3AgcEV8RnxHfEh8SXxKfEt8THxRfAUAAgAFOCFwAwACAB5wRHwTTAEABnwRTDAACBQVFCYUMhRAFEQUThQGGAoYExgXGCQYKBgwGDQYPhxCHEUcTiBOMBA8HDxOPARAB0AJQCRAJkBOSD1UTlRLWCxcLlwwXDJcPVxDXBhkPWQdaB9oIWgjaBVwLnQxdBN4EkwLAAokHCQ2JEUwB0QgRElYOXQheEl4SYQ="}];function s(t){function i(t){function i(t){return[4*(t%1024),4*Math.floor(t/1024)]}let s=[],e=function(t){const i=atob(t),s=i.length,e=new Uint8Array(s);for(let h=0;h<s;h++)e[h]=i.charCodeAt(h);return new Uint16Array(e.buffer)}(t);for(let h=0;h<e.length;){let t=e[h];h++;let n=e[h];h++;let r=[...e.slice(h,h+n)];h+=n,s.push(...r.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:e,t:h,i:n}=t;return{name:s,w:e,t:h,i:i(n)}}))}const e=new class{image;info;h;o;async load(){var e;this.image=await(e=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=e}))),this.info="bullet\n\n0*0*idle\n\n0*128*110\n\n\ncollect\n\n0*2*coin\n\n0*136*110\n0*144*110\n0*128*118\n\n\ncrash\n\n0*2*idle\n\n0*136*118\n0*144*118\n0*144*140\n\n\ncrawler\n\n0*1*idle\n\n0*144*148\n0*144*170\n\n\nfx_collect\n\n0*2*idle\n\n0*144*178\n0*144*200\n0*144*208\n\n\nfx_djump\n\n0*1*idle\n\n0*80*216\n0*88*216\n\n\nfx_flash\n\n0*1*idle\n\n0*96*216\n0*104*216\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*0*80\n4*0*110\n4*0*140\n4*0*170\n4*0*200\n\n\nmain_char\n\n0*1*idle\n2*3*run\n4*6*jump\n7*9*die\n\n0*112*216\n0*120*216\n0*128*216\n0*136*216\n0*144*216\n0*80*186\n0*88*186\n0*96*186\n0*104*186\n0*112*186\n\n\nnpc\n\n0*0*idle\n\n3*80*200\n\n\nrestart\n\n0*2*idle\n3*6*bg\n\n1*128*200\n1*80*170\n1*96*170\n1*112*170\n1*128*170\n1*80*140\n1*96*140\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n1*112*140\n1*128*140\n1*80*110\n1*96*110\n1*112*110\n\n\ntiles\n\n0*0*idle\n\n2*0*0".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,e]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,e]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:e}})),l:e.split(/\r?\n/).map((t=>{let[i,s,e,h,n,r,a,o]=function(t){let[i,s,e]=t,h=0,n=0,[r,a]=0===i?[8,8]:1===i?[16,16]:2===i?[80,80]:4===i?[80,30]:[0,0],[o,l]=[r,a];return[h,n,r,a,s,e,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:e,A:h,_:n,p:r,M:a,m:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],console.log(this.info),this.h=s(i)}};class h{constructor(t,i){this.canvas=t,this.B=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{B:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,e,h){let{B:n}=this;n.fillStyle=h,n.fillRect(t,i,s,e)}C(t,i){let{B:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{B:t}=this;t.restore()}D(t,i,s,e=1,h=1){let{fx:n,fy:r,_:a,p:o,M:l,m:d}=t.v,{I:u,U:c}=t,A=i-n-u,f=s-r-c;this.F(A,f,a,o,l,d,e,h)}k(t,i,s){let{fx:h,fy:n,_:r,p:a}=e.o,o=i-h,l=s-n,d=t%20*4,u=4*Math.floor(t/20);this.F(o,l,r+d,a+u,4,4)}F(t,i,s,h,n,r,a=1,o=1){let{B:l}=this,{image:d}=e;l.save();let u=n,c=r,A=u*Math.abs(a),f=c*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=A),o<0&&(i*=-1,i-=f),l.drawImage(d,s,h,u,c,Math.round(t),Math.round(i),Math.round(A),Math.round(f)),l.restore()}}const n={L:16,time:0,H(t,i=0){let{L:s,time:e}=this;return Math.floor((e-i-s)/t)<Math.floor((e-i)/t)}};class r{R;K(t){return this.R=t,this}visible=!0;parent;S;Y;O;T;V(t,i){this.T.push([t,i])}constructor(){this.O=[],this.Y=[],this.T=[]}P(t){return this.Y.filter((i=>i instanceof t))}N(t){return this.Y.find((i=>i instanceof t))}G(t,i){let s=(new t).K(i).init();return s.parent=this,s}J(t,i={}){let s=this.G(t,i);return this.Y.push(s),s}X(t,i={},s=7){let e=this.G(t,i);return this.Y.push(e),this.O.push([e,s]),e}remove(t){if(!t)return void(this.parent?this.parent.remove(this):this.W());let i=this.Y.indexOf(t);if(-1===i)throw"noscene rm";this.Y.splice(i,1),i=this.O.findIndex((([i])=>i===t)),-1!==i&&this.O.splice(i,1),t.W()}init(){return this.S=0,this.j(),this}update(){0===this.S&&this.Z(),this.Y.forEach((t=>t.update())),this.S+=n.L,this.T=this.T.map((([t,i])=>(t-n.L<0&&i(),[t-n.L,i]))).filter((t=>t[0]>0)),this.O.slice(0).forEach((([t,i])=>{let s=this.O.filter((i=>i[0].constructor.name===t.constructor.name));if(s.length>i){let t=s[0][0];this.remove(t)}})),this.q(),this.$()}draw(t){this.visible&&(this.tt(t),this.Y.forEach((i=>i.draw(t))),this.it(t))}W(){this.st()}j(){}Z(){}q(){}$(){}it(t){}tt(t){}st(){}}class a extends r{get data(){return this.R}get info(){let t=e.info.find((t=>t.name===this.et));if(!t)throw`nosprite ${this.et}`;return t}get duration(){return this.data.duration??.4}set duration(t){this.data.duration=t}get tag(){let t=this.info.tags.find((t=>t.name===this.ht));if(!t)throw`notag ${this.et} ${this.ht}`;return t}get et(){return this.data.name}get ht(){return this.data.tag||"idle"}x=0;y=0;nt=1;rt=1;ot(t,i){this.x=t,this.y=i}_current_frame=0;get v(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get lt(){return this.data.lt??"c"}get I(){if("tl"===this.lt)return 0;let{u:t}=this.v;return"c"===this.lt||"bc"===this.lt?t/2:0}get U(){if("tl"===this.lt)return 0;let{A:t}=this.v;return"c"===this.lt?t/2:"bc"===this.lt?t:0}dt(t){this.data.tag!==t&&(this.data.tag=t,this._current_frame=0,this.ut=0)}ut=0;q(){let{from:t,to:i}=this.tag,{duration:s}=this,e=s/(i-t+1),h=i-t;this.ut+=n.L,this.ut>=e&&(this.ut-=e,this._current_frame===h?!1!==this.data.loop&&(this._current_frame=0):this._current_frame+=1)}it(t){let{x:i,y:s,nt:e,rt:h}=this;t.D(this,i,s,e,h)}}const o=function(){let t=new Set;return document.addEventListener("keydown",(i=>{return s=i.key,void t.add(s);var s})),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var l=function(){var t,i,s,e,h,n=function(t){return Math.sin(6.283184*t)},r=function(t){return.003959503758*2**((t-128)/12)},a=function(t,i,s){var e,h,n,a,l,d,u=o[t.ct[0]],c=t.ct[1],A=t.ct[3]/32,f=o[t.ct[4]],g=t.ct[5],w=t.ct[8]/32,_=t.ct[9],p=t.ct[10]*t.ct[10]*4,M=t.ct[11]*t.ct[11]*4,m=t.ct[12]*t.ct[12]*4,B=1/m,x=-t.ct[13]/16,E=t.ct[14],C=s*2**(2-t.ct[15]),Q=new Int32Array(p+M+m),D=0,v=0;for(e=0,h=0;e<p+M+m;e++,h++)h>=0&&(h-=C,l=r(i+(15&(E=E>>8|(255&E)<<4))+t.ct[2]-128),d=r(i+(15&E)+t.ct[6]-128)*(1+8e-4*t.ct[7])),n=1,e<p?n=e/p:e>=p+M&&(n=(1-(n=(e-p-M)*B))*3**(x*n)),a=u(D+=l*n**A)*c,a+=f(v+=d*n**w)*g,_&&(a+=(2*Math.random()-1)*_),Q[e]=80*a*n|0;return Q},o=[n,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(n){t=n,i=n.At,s=0,e=n.ft*n.gt*(i+1)*2,h=new Int32Array(e)},this.wt=function(){var r,l,d,u,c,A,f,g,w,_,p,M,m,B,x=new Int32Array(e),E=t._t[s],C=t.ft,Q=t.gt,D=0,v=0,y=!1,I=[];for(d=0;d<=i;++d)for(f=E.Mt[d],u=0;u<Q;++u){var U=f?E.c[f-1].f[u]:0;U&&(E.ct[U-1]=E.c[f-1].f[u+Q]||0,U<17&&(I=[]));var F=o[E.ct[16]],k=E.ct[17]/512,L=2**(E.ct[18]-9)/C,H=E.ct[19],R=E.ct[20],K=43.23529*E.ct[21]*3.141592/44100,S=1-E.ct[22]/255,Y=1e-5*E.ct[23],b=E.ct[24]/32,O=E.ct[25]/512,T=6.283184*2**(E.ct[26]-9)/C,V=E.ct[27]/255,P=E.ct[28]*C&-2;for(p=(d*Q+u)*C,c=0;c<4;++c)if(A=f?E.c[f-1].n[u+c*Q]:0){I[A]||(I[A]=a(E,A,C));var N=I[A];for(l=0,r=2*p;l<N.length;l++,r+=2)x[r]+=N[l]}for(l=0;l<C;l++)(_=x[g=2*(p+l)])||y?(M=K,H&&(M*=F(L*g)*k+.5),v+=(M=1.5*Math.sin(M))*(m=S*(_-v)-(D+=M*v)),_=3==R?v:1==R?m:D,Y&&(_=(_*=Y)<1?_>-1?n(.25*_):-1:1,_/=Y),y=(_*=b)*_>1e-5,B=_*(1-(w=Math.sin(T*g)*O+.5)),_*=w):B=0,g>=P&&(B+=x[g-P+1]*V,_+=x[g-P]*V),x[g]=0|B,x[g+1]=0|_,h[g]+=0|B,h[g+1]+=0|_}return++s/t.Bt},this.xt=function(t){for(var i=t.createBuffer(2,e/2,44100),s=0;s<2;s++)for(var n=i.getChannelData(s),r=s;r<e;r+=2)n[r>>1]=h[r]/65536;return i}};const d={_t:[{ct:[1,85,125,1,1,83,130,9,1,0,17,22,44,0,0,0,1,108,3,0,1,15,167,0,27,48,2,57,1],Mt:[2,3,3,2,,,,,2,,3,,,,3,3,3],c:[{n:[149],f:[]},{n:[135,137,139,,156,,147,,147,137,139,,156,,156,,135,151,,135,156,,135,151,,135,151,,139,147,147],f:[]},{n:[139,137,135,,147,,156,,147,137,135,,151,,151,,144,147,,144,151,,144,156,,144,151,,144,147,147],f:[]}]},{ct:[1,128,128,0,2,127,128,0,0,0,7,6,39,9,0,0,0,195,4,0,3,50,184,119,115,61,6,59,2],Mt:[,,,,2,3,3,2,2,2,2,3,3,3,,3,,2,3],c:[{n:[],f:[]},{n:[137,,140,,149,,140,,137,,140,,149,,140,,137,140,156,,149,140,156,,,137,137,140,152,144,144,,,,144,,144,,,,,,144,,,,144],f:[]},{n:[139,142,146,139,,142,154,,151,142,146,139,,142,146,158,,139,146,158,,146,158,,,146,158,,,146,158,,,,,142,,,,,,,,142],f:[]}]},{ct:[0,221,128,64,0,210,128,0,64,255,4,6,73,79,0,0,0,64,7,1,3,195,15,0,32,20,0,24,6],Mt:[2,3,3,2,,,,,,2,,2,2,3,2,3,2,,2,2,3,3],c:[{n:[],f:[]},{n:[,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,135,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[,,,,135,,,,,,,,135,,,,,,,,135,,135,,135,,135,,135,,135,,,,,,,,,135,,,,,,,,135],f:[]}]}],ft:5513,gt:32,At:21,Bt:3},u=t=>({_t:[{ct:[1,109,120,0,0,53,120,4,0,0,15,0,48,15,50,2,1,0,0,0,2,255,96,0,37,24,1,67,1],Mt:[1],c:[{n:[t],f:[22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]}]}],ft:5513,gt:32,At:0,Bt:1}),c=[u(151),u(161),u(171)],A={_t:[{ct:[3,182,119,63,1,67,129,10,4,0,11,2,138,215,0,0,1,164,12,0,2,94,148,57,32,0,9,0,0],Mt:[1],c:[{n:[137],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2]}]}],ft:5513,gt:32,At:0,Bt:1},f=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},e=[{name:"song",data:d},{name:"pickup0",data:c[0]},{name:"pickup1",data:c[1]},{name:"pickup2",data:c[2]},{name:"damage",data:A}];return{wt:()=>(e.forEach((i=>{let e=new l;e.init(i.data),function h(){if(1===e.wt()){let h=e.xt(t);((t,i)=>{s[t]=i})(i.name,h)}else setTimeout(h,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==e.length?setTimeout(i,100):t()}()}))),play:(e,h=!1,n=.8)=>{const r=s[e];if(!r)return;let a=t.createBufferSource(),o=t.createGain();return a.buffer=r,a.connect(o),o.connect(i),a.loop=h,o.gain.value=n,a.start(),()=>{a.stop()}}}}();function g(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function w(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function _(t){let i;const s=e=>{i&&i.remove(),i=new e,i.K({g:t,go:s}),i.init()};s(M),function(t){let i;const s=e=>{n.L=Math.min(20,Math.max(16,i?e-i:16))/1e3,i=e,n.time+=n.L,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,64,64,"hsl(20, 5%, 50%)"),t.fr(1,1,62,62,"hsl(70, 15%, 30%)"),i.draw(t)}))}class p extends r{Et=!1;Ct;get data(){return this.R}get g(){return this.data.g}go(t){this.data.go(t)}update(){o("m")?this.Et||(this.Et=!0,this.Ct?(this.Ct(),this.Ct=void 0):this.Ct=f.play("song",!0)):this.Et=!1,super.update()}W(){console.log("here"),super.W(),this.Ct?.()}}class M extends p{j(){e.load().then((()=>{let t=this.J(a,{name:"loading",tag:"audio",duration:1});t.x=32,t.y=32,f.wt().then((()=>{this.go(m)}))}))}}class m extends p{Qt;j(){this.Ct=f.play("song",!0,.1),this.Qt=this.J(L),this.J(B)}q(){this.Qt.N(I)&&o("r")&&this.go(m)}}class B extends r{width=0;Dt=0;vt;yt;It(){this.Dt=.9,f.play("pickup"+Math.floor(3*Math.random()))}j(){let t=this.J(a,{name:"collect",tag:"coin"});t.x=3,t.y=3}q(){if(this.Dt>0&&(this.Dt=g(this.Dt,0,3*n.L),this.Dt<.5&&(this.width++,this.Dt=0)),this.vt&&this.vt>0&&(this.vt=g(this.vt,0,3*n.L),0===this.vt)){this.vt=void 0;let t=this.J(a,{name:"restart",tag:"bg",duration:.8});t.x=32,t.y=32,this.yt=this.J(a,{name:"restart",duration:5}),this.yt.x=32,this.yt.y=32}this.yt&&(this.yt.y=32+4*Math.sin(8*this.S))}it(t){t.fr(6,1,54,1,"#f7ffff"),t.fr(6,2,this.width,2,"#b4d800");let i=this.Dt/.9*1;t.fr(6+this.width,2,i,2,"#f59562")}}class x extends r{get Ut(){return{x:this.x,y:this.y,w:this.w/2,t:this.t/2}}D;Ft=!0;kt=1;Lt=.8;w=4;t=4;grid;dx=0;dy=0;x=0;y=0;Ht=0;Rt=0;Kt=this.St;Yt;bt;get Ot(){return Math.sign(this.dx)}get Tt(){return this.Ht<0}get St(){return this.Ht>0}get Vt(){return this.Rt<0}get Pt(){return this.Rt>0}draw(t){t.C(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}update(){super.update(),this.Kt=this.St}}class E extends x{kt=0;get data(){return this.R}get duration(){return this.data.duration??1}j(){this.D=this.J(a,{name:this.data.name})}q(){this.S>this.duration&&this.remove()}}class C extends E{kt=.3;j(){this.D=this.J(a,{name:"crash"})}}class Q extends x{Nt}class D extends Q{kt=0;Lt=64;Gt;j(){this.D=this.J(a,{name:"collect",tag:"coin",duration:.8})}q(){if(void 0!==this.Gt&&(this.Gt=g(this.Gt,0,n.L),this.Gt<2&&(n.H(.3)?this.visible&&(this.visible=!1):n.H(.1)&&(this.visible||(this.visible=!0))),0===this.Gt&&this.remove()),void 0!==this.Nt){if(this.Nt=g(this.Nt,0,n.L),this.D.duration=.16,0===this.Nt){let t=this.parent.J(E,{name:"fx_collect",duration:.3});t.x=this.x,t.y=this.y,this.remove()}}else this.dy=Math.sin(3*this.S)}}class v extends x{}class y extends v{w=8;t=8;j(){this.D=this.J(a,{name:"crawler"}),this.dx=1.2}q(){this.D.nt=this.Ot}}class I extends x{kt=0;Ft=!1;j(){this.J(a,{name:"main_char",tag:"die",loop:!1})}}class U extends x{w=8;t=8;Jt=0;Xt=0;Wt=2;jt=0;Zt;zt=!1;qt=!1;j(){this.D=this.J(a,{name:"main_char"})}q(){if(this.Jt>0)return void(this.Jt=g(this.Jt,0,n.L));let t=o("x"),i=o("ArrowLeft")||o("a"),s=o("ArrowRight")||o("d"),e=o("ArrowUp")||o("w");if(this.zt=i,this.qt=s,this.dx=i?-8:s?8:0,e?void 0!==this.jt&&(this.jt+=n.L):void 0===this.jt?this.jt=0:this.jt>0&&(this.jt=-.3),void 0!==this.jt&&this.jt<0&&(this.jt+=n.L,this.jt>=0&&(this.jt=void 0)),void 0!==this.jt&&this.jt>0)if(void 0!==this.Zt)this.dy=-40,this.jt=void 0,this.Wt=1;else if(this.Wt>0){this.dy=-40,this.jt=void 0,this.Wt=0;let t=this.parent.J(E,{name:"fx_djump",duration:.4});t.x=this.x,t.y=this.y+5}if(this.St?this.Zt=0:this.Kt&&(this.Zt=.16),void 0!==this.Zt&&this.Zt>0&&(this.Zt=g(this.Zt,0,n.L),0===this.Zt&&(this.Zt=void 0)),this.St?0!==this.dx?(this.D.dt("run"),this.D.nt=this.Ot):this.D.dt("idle"):(this.D.dt("jump"),0!==this.Ot&&(this.D.nt=this.Ot)),t&&0===this.Xt){let t=this.parent.X(k,{dx:this.dx,dy:10});t.x=this.x,t.y=this.y,this.dx*=-6,this.Xt=.2}this.Xt=g(this.Xt,0,n.L)}$(){}}class F extends r{w=4;t=4;x;y;dx;dy;q(){this.dy=Math.sin(8*this.S)*Math.sin(16*this.S)*20,this.S>1.5&&this.remove()}draw(t){t.C(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}}class k extends F{get data(){return this.R}j(){this.dx=2*this.data.dx,this.dy=this.data.dy,this.J(a,{name:"bullet"})}}class L extends r{get $t(){return this.parent.N(B)}o;ti=0;ii=0;si=this.ti;ei=this.ii;get hi(){return 4*this.o[0].length}ni(t,i,s){return!!this.ri(t,i,s)}ri(t,i,s){let{x:e,y:h,w:n,t:r}=t;return this.ai(e-n/2+i,h-r/2+s,n,r)}ai(t,i,s=1,e=1){let h=this.o[0].length,n=this.o.length,r=t/4,a=i/4,o=(t+s-1)/4,l=(i+e-1)/4;if(r<0||o>=h||a<0||l>=n)return!0;for(t=r;t<=o;t++)for(i=a;i<=l;i++)if(t=Math.floor(t),i=Math.floor(i),R(this.o[i][t]))return[4*t,4*i]}j(){let t=e.h[0];this.o=[];for(let i=0;i<t.t;i++)this.o[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:e}=t.i[i],h=s[0]/4,n=s[1]/4,r=e[1]/4*20+e[0]/4;if(399===r){let t=this.J(U);t.x=s[0],t.y=s[1]}else if(398===r){let t=this.J(y);t.x=s[0],t.y=s[1]}else if(397===r){let t=this.J(D);t.x=s[0],t.y=s[1]}else this.o[n][h]=r}}q(){let t=this.N(U);if(this.P(y).forEach((t=>{!this.ni(t,Math.sign(t.dx),0)&&this.ni(t,4*Math.sign(t.dx),1)||(t.dx*=-1)})),t&&0===t.Jt){this.Y.filter((t=>t instanceof Q)).forEach((i=>{void 0===i.Nt&&w(i,t)&&(i.Nt=.3,i.dy=-8,this.$t?.It())})),this.Y.filter((t=>t instanceof v)).forEach((i=>{if(w(i.Ut,t.Ut)){if(0===this.$t.width){t.remove();let i=this.J(I);i.x=t.x,i.y=t.y,this.$t.vt=2}t.J(E,{name:"fx_flash"}),f.play("damage"),t.Jt=1,t.dy=-32,0===t.dx?t.dx=6.4:t.dx=8*-Math.sign(t.dx)*.8;for(let i=0;i<this.$t.width;i++){let s=this.J(D);s.x=t.x,s.y=t.y,s.dx=8*Math.sin(i/this.$t.width*Math.PI*2),s.dy=80*Math.cos(i/this.$t.width*Math.PI*2),s.Gt=5}this.$t.width=0}}))}if(t&&void 0===t.Yt){let i=this.ni(t,0,2),s=this.ri(t,1,-1)?void 0:this.ri(t,1,0),e=this.ri(t,-1,-1)?void 0:this.ri(t,-1,0);i||(t.qt&&Array.isArray(s)?(t.Yt=.2,t.x=s[0],t.y=s[1]):t.zt&&Array.isArray(e)&&(t.Yt=-.2,t.x=e[0]+4,t.y=e[1]))}if(t&&!t.Yt&&void 0===t.bt){let i=this.ri(t,1,-4)?void 0:this.ri(t,1,0),s=this.ri(t,-1,-4)?void 0:this.ri(t,-1,0);t.qt&&Array.isArray(i)?(t.bt=.16,t.x=i[0],t.y=i[1]-1):t.zt&&Array.isArray(s)&&(t.bt=-.16,t.x=s[0]+4,t.y=s[1]-1)}if(this.Y.filter((t=>t instanceof x)).forEach((t=>{let i=this.ri(t,0,0);if(void 0!==t.Yt)return t.Yt=g(t.Yt,0,n.L),void(0===t.Yt&&(t.Yt=void 0,t.y=i[1]-4,t.dy=0));if(void 0!==t.bt)return t.bt=g(t.bt,0,n.L),void(0===t.bt&&(t.bt=void 0,t.y=i[1]-4,t.dy=0));let s=4*t.kt,e=0;{let i=Math.abs(t.dy),h=Math.sign(t.dy);for(let r=0;r<i;r+=1){let a=.5*h*Math.sqrt(n.L);if(this.ni(t,0,a)){t.Ht=h,t.dy/=2,e=0;break}t.Ht=0,t.y+=a,e=1-h*(r/i);{let i=t.Lt*s*Math.sqrt(e),h=1;t.dy+=h*i*n.L}}}{let i=3*s,e=1;for(let s=0;s<i;s+=1){let i=.5*e*Math.sqrt(n.L);if(this.ni(t,0,i)){t.Ht=e,t.dy=0;break}t.Ht=0,t.y+=i}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),e=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(n.L)*e;if(this.ni(t,i,0)){t.Rt=s,t.dx=0;break}t.Rt=0,t.x+=i}}})),t&&(this.si<t.x-4-1&&(this.si=t.x-4-1),this.si>t.x+4+1&&(this.si=t.x+4+1),this.ei<t.y-8&&(this.ei=t.y-8),this.ei>t.y+8&&(this.ei=t.y+8)),t){let i=t.dx<0?-50:t.dx>0?-10:-32;this.ti=g(this.ti,this.si+i,50*n.L),this.ii=this.ei-32,this.ti=Math.min(Math.max(0,this.ti),this.hi)}else this.ti=g(this.ti,this.ti+8*Math.sin(9*this.S),8*n.L),this.ii=g(this.ii,this.ii+8*Math.cos(9*this.S),8*n.L);this.Y.filter((t=>t instanceof F)).forEach((t=>{{let i=Math.abs(t.dy),s=Math.sign(t.dy);for(let e=0;e<i;e+=1){let i=.5*s*Math.sqrt(n.L);if(this.ni(t,0,i)){t.dy/=2;break}t.y+=i;{let i=1,s=1;t.dy+=s*i*n.L}}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),e=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(n.L)*e;if(this.ni(t,i,0)){t.dx=0;let i=this.X(C);i.x=t.x-2*s,i.y=t.y,i.D.nt=s,this.remove(t);break}t.x+=i}}}))}tt(t){t.C(-this.ti,-this.ii);for(let i=0;i<this.o.length;i++){let s=this.o[i];for(let e=0;e<s.length;e++){let h=s[e];t.k(h,4*e,4*i)}}}it(t){t.pop()}}const H=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],R=t=>H.includes(t);!function(t){let i=function(t,i,s=!0){let e=document.createElement("canvas");s&&e.classList.add("pixelated");let n=e.getContext("2d");const r=()=>{e.width=t,e.height=i,n.imageSmoothingEnabled=s};return document.addEventListener("scroll",r,{capture:!0,passive:!0}),window.addEventListener("resize",r,{passive:!0}),r(),new h(e,n)}(64,64,!0);t.appendChild(i.canvas),_(i)}(document.getElementById("app"));
