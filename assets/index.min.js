const t=""+new URL("out_0-CSp0bpT6.png",import.meta.url).href,e=[{n:"Level_0",w:64,t:32,i:"AAACAAYYACwBAIgABxgIGAkYChgEIAUgBiAKIAsgDCANIA4gDyAQIBYgFyAYIBkgGiAmICcgKCApIBYkGiQWKBooASwDLAQsBSwGLAcsCCwJLAosCywMLA0sDiwPLBAsESwSLBMsFCwVLBYsFywYLBksGiwbLBwsHSweLB8sICwhLCIsKywsLC0sLiwvLDAsMSwyLDMsNCw1LDYsNyw4LDksOiw7LDwsPSw+LD8sHTAdNBw4HTgjOBw8JDwlPCY8HEAdQB9AIEAhQCdAKEApQB1EKkQrRB1IHkgfSCBIIUgiSCNIJEglSCZIJ0goSClIKkgrSCxILUguSC9IMEgxSDJIM0g0SDVINkg3SDhIOUg6SDtIPEg9SD5IP0gCAAEACxgCBAYABhwLHBQwFDQUOBQ8E0wBAAIoAQQBAAIsAAQEAAAwADQAOAA8"}];function i(t){function e(t){function e(t){return[4*(t%1024),4*Math.floor(t/1024)]}let i=[],s=function(t){const e=atob(t),i=e.length,s=new Uint8Array(i);for(let n=0;n<i;n++)s[n]=e.charCodeAt(n);return new Uint16Array(s.buffer)}(t);for(let n=0;n<s.length;){let t=s[n];n++;let r=s[n];n++;let h=[...s.slice(n,n+r)];n+=r,i.push(...h.map((i=>({src:e(t),px:e(i)}))))}return i}return t.map((t=>{let{n:i,w:s,t:n,i:r}=t;return{name:i,w:s,t:n,i:e(r)}}))}const s=new class{image;info;h;o;async load(){var s;this.image=await(s=t,new Promise((t=>{let e=new Image;e.onload=()=>t(e),e.src=s}))),this.info="loading\n\n0*1*audio\n2*4*input\n\n4*0*80\n4*0*110\n4*0*140\n4*0*170\n4*0*200\n\n\nmain_char\n\n0*0*idle\n\n0*80*216\n\n\nnpc\n\n0*0*idle\n\n3*80*200\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n1*128*200\n1*80*170\n1*96*170\n1*112*170\n1*128*170\n\n\ntiles\n\n0*0*idle\n\n2*0*0".split(/\r?\n\r?\n\r?\n/).map((t=>{let[e,i,s]=t.split(/\r?\n\r?\n/);return{name:e,tags:i.split(/\r?\n/).map((t=>{let[e,i,s]=t.split("*");return{from:parseInt(e),to:parseInt(i),name:s}})),l:s.split(/\r?\n/).map((t=>{let[e,i,s,n,r,h,a,o]=function(t){let[e,i,s]=t,n=0,r=0,[h,a]=0===e?[8,8]:1===e?[16,16]:2===e?[80,80]:4===e?[80,30]:[0,0],[o,l]=[h,a];return[n,r,h,a,i,s,o,l]}(t.split("*").map((t=>parseInt(t))));return{fx:e,fy:i,u:s,_:n,A:r,p:h,m:a,M:o}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).l[0],console.log(this.info),this.h=i(e)}};class n{constructor(t,e){this.canvas=t,this.I=e}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{I:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,e,i,s,n){let{I:r}=this;r.fillStyle=n,r.fillRect(t,e,i,s)}v(t,e){let{I:i}=this;i.save(),i.translate(Math.floor(t),Math.floor(e))}pop(){let{I:t}=this;t.restore()}C(t,e,i,s=1,n=1){let{fx:r,fy:h,A:a,p:o,m:l,M:u}=t.B,{L:c,S:f}=t,d=e-r-c,w=i-h-f;this.k(d,w,a,o,l,u,s,n)}D(t,e,i){let{fx:n,fy:r,A:h,p:a}=s.o,o=e-n,l=i-r,u=t%20*4,c=4*Math.floor(t/20);this.k(o,l,h+u,a+c,4,4)}k(t,e,i,n,r,h,a=1,o=1){let{I:l}=this,{image:u}=s;l.save();let c=r,f=h,d=c*Math.abs(a),w=f*Math.abs(o);l.scale(Number(a.toFixed(2)),Number(o.toFixed(2))),a<0&&(t*=-1,t-=d),o<0&&(e*=-1,e-=w),l.drawImage(u,i,n,c,f,Math.round(t),Math.round(e),Math.round(d),Math.round(w)),l.restore()}}const r={Y:16};class h{U;N(t){return this.U=t,this}P;K;F;H;O(t,e){this.H.push([t,e])}constructor(){this.F=[],this.K=[],this.H=[]}G(t){return this.K.filter((e=>e instanceof t))}J(t){return this.K.find((e=>e instanceof t))}T(t,e){return(new t).N(e).init()}j(t,e={}){let i=this.T(t,e);return this.K.push(i),i}R(t,e={},i=7){let s=this.T(t,e);return this.K.push(s),this.F.push([s,i]),s}remove(t){let e=this.K.indexOf(t);if(-1===e)throw"noscene rm";this.K.splice(e,1),e=this.F.findIndex((([e])=>e===t)),-1!==e&&this.F.splice(e,1)}init(){return this.P=0,this.$(),this}update(){0===this.P&&this.q(),this.K.forEach((t=>t.update())),this.P+=r.Y,this.H=this.H.map((([t,e])=>(t-r.Y<0&&e(),[t-r.Y,e]))).filter((t=>t[0]>0)),this.F.slice(0).forEach((([t,e])=>{let i=this.F.filter((e=>e[0].constructor.name===t.constructor.name));if(i.length>e){let t=i[0][0];this.remove(t)}})),this.V(),this.W()}draw(t){this.Z(t),this.K.forEach((e=>e.draw(t))),this.X(t)}$(){}q(){}V(){}W(){}X(t){}Z(t){}}class a extends h{get data(){return this.U}get info(){let t=s.info.find((t=>t.name===this.tt));if(!t)throw`nosprite ${this.tt}`;return t}get duration(){return this.data.duration??400}get tag(){let t=this.info.tags.find((t=>t.name===this.et));if(!t)throw`notag ${this.tt} ${this.et}`;return t}get tt(){return this.data.name}get et(){return this.data.tag||"idle"}x=0;y=0;it=1;st=1;nt(t,e){this.x=t,this.y=e}_current_frame=0;get B(){let{from:t}=this.tag;return this.info.l[this._current_frame+t]}get rt(){return this.data.rt??"c"}get L(){if("tl"===this.rt)return 0;let{u:t}=this.B;return"c"===this.rt||"bc"===this.rt?t/2:0}get S(){if("tl"===this.rt)return 0;let{_:t}=this.B;return"c"===this.rt?t/2:"bc"===this.rt?t:0}ht(t){this.data.tag=t,this._current_frame=0,this.ot=0}ot=0;V(){let{from:t,to:e}=this.tag,{duration:i}=this,s=i/(e-t+1),n=e-t;this.ot+=1e3*r.Y,this.ot>=s&&(this.ot-=s,this._current_frame===n?this._current_frame=0:this._current_frame+=1)}X(t){let{x:e,y:i,it:s,st:n}=this;t.C(this,e,i,s,n)}}const o=function(){let t=new Set;return document.addEventListener("keydown",(e=>{return i=e.key,void t.add(i);var i})),document.addEventListener("keyup",(e=>{return i=e.key,void t.delete(i);var i})),e=>[...t].includes(e)}();var l=function(){var t,e,i,s,n,r=function(t){return Math.sin(6.283184*t)},h=function(t){return.003959503758*2**((t-128)/12)},a=function(t,e,i){var s,n,r,a,l,u,c=o[t.lt[0]],f=t.lt[1],d=t.lt[3]/32,w=o[t.lt[4]],g=t.lt[5],_=t.lt[8]/32,A=t.lt[9],p=t.lt[10]*t.lt[10]*4,m=t.lt[11]*t.lt[11]*4,x=t.lt[12]*t.lt[12]*4,y=1/x,M=-t.lt[13]/16,I=t.lt[14],v=i*2**(2-t.lt[15]),C=new Int32Array(p+m+x),B=0,L=0;for(s=0,n=0;s<p+m+x;s++,n++)n>=0&&(n-=v,l=h(e+(15&(I=I>>8|(255&I)<<4))+t.lt[2]-128),u=h(e+(15&I)+t.lt[6]-128)*(1+8e-4*t.lt[7])),r=1,s<p?r=s/p:s>=p+m&&(r=(1-(r=(s-p-m)*y))*3**(M*r)),a=c(B+=l*r**d)*f,a+=w(L+=u*r**_)*g,A&&(a+=(2*Math.random()-1)*A),C[s]=80*a*r|0;return C},o=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var e=t%1*4;return e<2?e-1:3-e}];this.init=function(r){t=r,e=r.ut,i=0,s=r.ct*r.ft*(e+1)*2,n=new Int32Array(s)},this.dt=function(){var h,l,u,c,f,d,w,g,_,A,p,m,x,y,M=new Int32Array(s),I=t.wt[i],v=t.ct,C=t.ft,B=0,L=0,S=!1,k=[];for(u=0;u<=e;++u)for(w=I.gt[u],c=0;c<C;++c){var D=w?I.c[w-1].f[c]:0;D&&(I.lt[D-1]=I.c[w-1].f[c+C]||0,D<17&&(k=[]));var Q=o[I.lt[16]],b=I.lt[17]/512,E=2**(I.lt[18]-9)/v,Y=I.lt[19],U=I.lt[20],N=43.23529*I.lt[21]*3.141592/44100,P=1-I.lt[22]/255,K=1e-5*I.lt[23],F=I.lt[24]/32,H=I.lt[25]/512,O=6.283184*2**(I.lt[26]-9)/v,G=I.lt[27]/255,J=I.lt[28]*v&-2;for(p=(u*C+c)*v,f=0;f<4;++f)if(d=w?I.c[w-1].n[c+f*C]:0){k[d]||(k[d]=a(I,d,v));var T=k[d];for(l=0,h=2*p;l<T.length;l++,h+=2)M[h]+=T[l]}for(l=0;l<v;l++)(A=M[g=2*(p+l)])||S?(m=N,Y&&(m*=Q(E*g)*b+.5),L+=(m=1.5*Math.sin(m))*(x=P*(A-L)-(B+=m*L)),A=3==U?L:1==U?x:B,K&&(A=(A*=K)<1?A>-1?r(.25*A):-1:1,A/=K),S=(A*=F)*A>1e-5,y=A*(1-(_=Math.sin(O*g)*H+.5)),A*=_):y=0,g>=J&&(y+=M[g-J+1]*G,A+=M[g-J]*G),M[g]=0|y,M[g+1]=0|A,n[g]+=0|y,n[g+1]+=0|A}return++i/t._t},this.At=function(t){for(var e=t.createBuffer(2,s/2,44100),i=0;i<2;i++)for(var r=e.getChannelData(i),h=i;h<s;h+=2)r[h>>1]=n[h]/65536;return e}};const u={wt:[{lt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],gt:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{lt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],gt:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{lt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],gt:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],ct:7350,ft:32,ut:22,_t:3},c=function(){let t=new AudioContext,e=t.createGain();e.connect(t.destination);const i={},s=[{name:"song",data:u}];return{dt:()=>(s.forEach((e=>{let s=new l;s.init(e.data),function n(){if(1===s.dt()){let n=s.At(t);((t,e)=>{i[t]=e})(e.name,n)}else setTimeout(n,0)}()})),new Promise((t=>{!function e(){Object.keys(i).length!==s.length?setTimeout(e,100):t()}()}))),play:(s,n=!1)=>{const r=i[s];if(!r)return;let h=t.createBufferSource(),a=t.createGain();return h.buffer=r,h.connect(a),a.connect(e),h.loop=n,a.gain.value=.8,h.start(),()=>{h.stop()}}}}();function f(t){let e;const i=s=>{e=new s,e.N({g:t,go:i}),e.init()};i(w),function(t){let e;const i=s=>{r.Y=Math.min(20,Math.max(16,e?s-e:16))/1e3,e=s,t(),requestAnimationFrame(i)};requestAnimationFrame(i)}((()=>{e.update(),t.clear(),t.fr(0,0,64,64,"#1a001a"),t.fr(1,1,62,62,"#1f0f1f"),e.draw(t)}))}class d extends h{xt=!1;yt;get data(){return this.U}get g(){return this.data.g}go(t){this.data.go(t)}update(){o("m")?this.xt||(this.xt=!0,this.yt?(this.yt(),this.yt=void 0):this.yt=c.play("song",!0)):this.xt=!1,super.update()}}class w extends d{$(){s.load().then((()=>{let t=this.j(a,{name:"loading",tag:"audio",duration:1e3});t.x=32,t.y=32,c.dt().then((()=>{this.go(g)}))}))}}class g extends d{$(){this.j(p)}}class _ extends h{w=4;t=4;grid;dx=0;dy=0;x=0;y=0;Mt=0;It=0;vt=this.Ct;get Bt(){return this.Mt<0}get Ct(){return this.Mt>0}get Lt(){return this.It<0}get St(){return this.It>0}draw(t){t.v(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}update(){super.update(),this.vt=this.Ct}}class A extends _{w=8;t=8;kt=0;$(){this.j(a,{name:"main_char"})}V(){let t=o("ArrowLeft")||o("a"),e=o("ArrowRight")||o("d"),i=o("ArrowUp")||o("w");this.dx=t?-8:e?8:0,i?void 0!==this.kt&&(this.kt+=r.Y):void 0===this.kt?this.kt=0:this.kt>0&&(this.kt=-.3),void 0!==this.kt&&this.kt<0&&(this.kt+=r.Y,this.kt>=0&&(this.kt=void 0)),void 0!==this.kt&&this.kt>0&&this.Ct&&(this.dy=-40,this.kt=void 0)}W(){}}class p extends h{o;Dt=0;Qt=0;bt=this.Dt;Et=this.Qt;get Yt(){return 4*this.o[0].length}Ut(t,e,i){let{x:s,y:n,w:r,t:h}=t;return this.Nt(s-r/2+e,n-h/2+i,r,h)}Nt(t,e,i=1,s=1){let n=this.o[0].length,r=this.o.length,h=t/4,a=e/4,o=(t+i-1)/4,l=(e+s-1)/4;if(h<0||o>=n||a<0||l>=r)return!0;for(t=h;t<=o;t++)for(e=a;e<=l;e++)if(t=Math.floor(t),e=Math.floor(e),x(this.o[e][t]))return!0;return!1}$(){let t=s.h[0];this.o=[];for(let e=0;e<t.t;e++)this.o[e]=Array(t.w);for(let e=0;e<t.i.length;e++){let{px:i,src:s}=t.i[e],n=i[0]/4,r=i[1]/4,h=s[1]/4*20+s[0]/4;if(399===h){let t=this.j(A);t.x=i[0],t.y=i[1]}else this.o[r][n]=h}}V(){this.K.filter((t=>t instanceof _)).forEach((t=>{let e=0;{let i=Math.abs(t.dy),s=Math.sign(t.dy);for(let n=0;n<i;n+=1){let h=.5*s*Math.sqrt(r.Y);if(this.Ut(t,0,h)){t.Mt=s,t.dy/=2,e=0;break}console.log("ok",t.y+h),t.Mt=0,t.y+=h,e=1-s*(n/i);{let i=3.2*Math.sqrt(e),s=1;t.dy+=s*i*r.Y}}}{let e=12,i=1;for(let s=0;s<e;s+=1){let e=.5*i*Math.sqrt(r.Y);if(this.Ut(t,0,e)){t.Mt=i,t.dy=0;break}t.Mt=0,t.y+=e}}{let e=Math.abs(t.dx),i=Math.sign(t.dx),s=1;for(let n=0;n<e;n+=1){let e=.5*i*Math.sqrt(r.Y)*s;if(this.Ut(t,e,0)){t.It=i,t.dx=0;break}t.It=0,t.x+=e}}}));let t=this.J(A);var e,i,s;t&&(this.bt<t.x-4-10&&(this.bt=t.x-4-10),this.bt>t.x+4+10&&(this.bt=t.x+4+10),this.Et<t.y-20&&(this.Et=t.y-20),this.Et>t.y+20&&(this.Et=t.y+20)),this.Dt=(e=this.Dt,i=this.bt-32,s=40*r.Y,e<i?Math.min(e+s,i):e>i?Math.max(e-s,i):e),this.Qt=this.Et-32,this.Dt=Math.min(Math.max(0,this.Dt),this.Yt)}Z(t){t.v(-this.Dt,-this.Qt);for(let e=0;e<this.o.length;e++){let i=this.o[e];for(let s=0;s<i.length;s++){let n=i[s];t.D(n,4*s,4*e)}}}X(t){t.pop()}}const m=[0,1,2],x=t=>m.includes(t);!function(t){let e=function(t,e,i=!0){let s=document.createElement("canvas");i&&s.classList.add("pixelated");let r=s.getContext("2d");const h=()=>{s.width=t,s.height=e,r.imageSmoothingEnabled=i};return document.addEventListener("scroll",h,{capture:!0,passive:!0}),window.addEventListener("resize",h,{passive:!0}),h(),new n(s,r)}(64,64,!0);t.appendChild(e.canvas),f(e)}(document.getElementById("app"));
