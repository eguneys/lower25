const t=""+new URL("out_0-Bc64baGJ.png",import.meta.url).href,n=[{n:"Level_0",w:68,t:16,i:"AAAHAAAAAQACAAAEAAgAIAAoAQBVAB8AIAAhACIAIwAkAAAMAQwCDAMMBAwFDAYMASgCKAMoBCgFKAYoBygIKAkoCigLKAwoDSgOKA8oECgRKBIoEygUKBUoFigXKBgoGSgaKBsoHCgdKB4oHyggKCEoIigjKCQoJSgmKCcoKCgpKCooKygsKC0oLigvKDAoMSgyKDMoNCg1KDYoNyg4KDkoOig7KDwoPSg+KD8oQChBKEIoJiwnLCgsKSwqLCssAgBDAEAAQQBCAEMAQwRDCEMMQxxDKAAsASwCLAMsBCwFLAYsBywILAksCiwLLAwsDSwOLA8sECwsLC0sLiwvLDAsMSwyLDMsNCw1LDYsNyw4LDksOiw7LDwsPSw+LD8sQCxBLEIsQywDMAQwBTAGMAcwCDAJMAowCzAMMA0wLTAuMC8wMDAxMDIwCSQBAAMk"}];function e(t){function n(t){function n(t){return[8*(t%1024),8*Math.floor(t/1024)]}let e=[],s=function(t){const n=atob(t),e=n.length,s=new Uint8Array(e);for(let i=0;i<e;i++)s[i]=n.charCodeAt(i);return new Uint16Array(s.buffer)}(t);for(let i=0;i<s.length;){let t=s[i];i++;let r=s[i];i++;let h=[...s.slice(i,i+r)];i+=r,e.push(...h.map((e=>({src:n(t),px:n(e)}))))}return e}return t.map((t=>{let{n:e,w:s,t:i,i:r}=t;return{name:e,w:s,t:i,i:n(r)}}))}const s=new class{image;info;h;o;async load(){var s;this.image=await(s=t,new Promise((t=>{let n=new Image;n.onload=()=>t(n),n.src=s}))),this.info="loading\n\n0*1*audio\n2*4*input\n\n4*0*80\n4*0*110\n4*0*140\n4*0*170\n4*0*200\n\n\nmain_char\n\n0*0*idle\n\n0*80*200\n\n\nnpc\n\n0*0*idle\n\n3*96*200\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n0*80*170\n0*96*170\n0*112*170\n0*128*170\n0*80*140\n\n\ntiles\n\n0*0*idle\n\n2*0*0".split(/\r?\n\r?\n\r?\n/).map((t=>{let[n,e,s]=t.split(/\r?\n\r?\n/);return{name:n,tags:e.split(/\r?\n/).map((t=>{let[n,e,s]=t.split("*");return{from:parseInt(n),to:parseInt(e),name:s}})),u:s.split(/\r?\n/).map((t=>{let[n,e,s,i,r,h,o,a]=function(t){let[n,e,s]=t,i=0,r=0,[h,o]=0===n?[16,16]:1===n?[32,16]:2===n?[80,80]:4===n?[80,30]:[0,0],[a,u]=[h,o];return[i,r,h,o,e,s,a,u]}(t.split("*").map((t=>parseInt(t))));return{fx:n,fy:e,l:s,A:i,_:r,m:h,p:o,M:a}}))}})),this.o=this.info.find((t=>"tiles"===t.name)).u[0],console.log(this.info),this.h=e(n)}};class i{constructor(t,n){this.canvas=t,this.C=n}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{C:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,n,e,s,i){let{C:r}=this;r.fillStyle=i,r.fillRect(t,n,e,s)}K(t,n){let{C:e}=this;e.save(),e.translate(t,n)}pop(){let{C:t}=this;t.restore()}v(t,n,e,s=1,i=1){let{fx:r,fy:h,_:o,m:a,p:u,M:l}=t.D,{L:c,B:f}=t,A=n-r-c,w=e-h-f;this.I(A,w,o,a,u,l,s,i)}S(t,n,e){let{fx:i,fy:r,_:h,m:o}=s.o,a=n-i,u=e-r,l=t%80,c=Math.floor(t/80);this.I(a,u,h+l,o+c,8,8)}I(t,n,e,i,r,h,o=1,a=1){let{C:u}=this,{image:l}=s;u.save();let c=r,f=h,A=c*Math.abs(o),w=f*Math.abs(a);u.scale(Number(o.toFixed(2)),Number(a.toFixed(2))),o<0&&(t*=-1,t-=A),a<0&&(n*=-1,n-=w),u.drawImage(l,e,i,c,f,Math.round(t),Math.round(n),Math.round(A),Math.round(w)),u.restore()}}const r={k:16};class h{F;N(t){return this.F=t,this}O;P;U;Y;J(t,n){this.Y.push([t,n])}constructor(){this.U=[],this.P=[],this.Y=[]}T(t,n){return(new t).N(n).init()}j(t,n={}){let e=this.T(t,n);return this.P.push(e),e}q(t,n={},e=7){let s=this.T(t,n);return this.P.push(s),this.U.push([s,e]),s}remove(t){let n=this.P.indexOf(t);if(-1===n)throw"noscene rm";this.P.splice(n,1),n=this.U.findIndex((([n])=>n===t)),-1!==n&&this.U.splice(n,1)}init(){return this.O=0,this.G(),this}update(){0===this.O&&this.H(),this.P.forEach((t=>t.update())),this.O+=r.k,this.Y=this.Y.map((([t,n])=>(t-r.k<0&&n(),[t-r.k,n]))).filter((t=>t[0]>0)),this.U.slice(0).forEach((([t,n])=>{let e=this.U.filter((n=>n[0].constructor.name===t.constructor.name));if(e.length>n){let t=e[0][0];this.remove(t)}})),this.R()}draw(t){this.$(t),this.P.forEach((n=>n.draw(t))),this.V(t)}G(){}H(){}R(){}V(t){}$(t){}}class o extends h{get data(){return this.F}get info(){let t=s.info.find((t=>t.name===this.X));if(!t)throw`nosprite ${this.X}`;return t}get duration(){return this.data.duration??400}get tag(){let t=this.info.tags.find((t=>t.name===this.W));if(!t)throw`notag ${this.X} ${this.W}`;return t}get X(){return this.data.name}get W(){return this.data.tag||"idle"}x=0;y=0;Z=1;tt=1;nt(t,n){this.x=t,this.y=n}_current_frame=0;get D(){let{from:t}=this.tag;return this.info.u[this._current_frame+t]}get et(){return this.data.et??"c"}get L(){if("tl"===this.et)return 0;let{l:t}=this.D;return"c"===this.et||"bc"===this.et?t/2:0}get B(){if("tl"===this.et)return 0;let{A:t}=this.D;return"c"===this.et?t/2:"bc"===this.et?t:0}st(t){this.data.tag=t,this._current_frame=0,this.it=0}it=0;R(){let{from:t,to:n}=this.tag,{duration:e}=this,s=e/(n-t+1),i=n-t;this.it+=1e3*r.k,this.it>=s&&(this.it-=s,this._current_frame===i?this._current_frame=0:this._current_frame+=1)}V(t){let{x:n,y:e,Z:s,tt:i}=this;t.v(this,n,e,s,i)}}const a=function(){let t=new Set;return document.addEventListener("keydown",(n=>{return e=n.key,void t.add(e);var e})),document.addEventListener("keyup",(n=>{return e=n.key,void t.delete(e);var e})),n=>[...t].includes(n)}();var u=function(){var t,n,e,s,i,r=function(t){return Math.sin(6.283184*t)},h=function(t){return.003959503758*2**((t-128)/12)},o=function(t,n,e){var s,i,r,o,u,l,c=a[t.rt[0]],f=t.rt[1],A=t.rt[3]/32,w=a[t.rt[4]],g=t.rt[5],d=t.rt[8]/32,_=t.rt[9],m=t.rt[10]*t.rt[10]*4,p=t.rt[11]*t.rt[11]*4,y=t.rt[12]*t.rt[12]*4,x=1/y,M=-t.rt[13]/16,C=t.rt[14],K=e*2**(2-t.rt[15]),v=new Int32Array(m+p+y),D=0,L=0;for(s=0,i=0;s<m+p+y;s++,i++)i>=0&&(i-=K,u=h(n+(15&(C=C>>8|(255&C)<<4))+t.rt[2]-128),l=h(n+(15&C)+t.rt[6]-128)*(1+8e-4*t.rt[7])),r=1,s<m?r=s/m:s>=m+p&&(r=(1-(r=(s-m-p)*x))*3**(M*r)),o=c(D+=u*r**A)*f,o+=w(L+=l*r**d)*g,_&&(o+=(2*Math.random()-1)*_),v[s]=80*o*r|0;return v},a=[r,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var n=t%1*4;return n<2?n-1:3-n}];this.init=function(r){t=r,n=r.ht,e=0,s=r.ot*r.ut*(n+1)*2,i=new Int32Array(s)},this.lt=function(){var h,u,l,c,f,A,w,g,d,_,m,p,y,x,M=new Int32Array(s),C=t.ct[e],K=t.ot,v=t.ut,D=0,L=0,B=!1,I=[];for(l=0;l<=n;++l)for(w=C.ft[l],c=0;c<v;++c){var Q=w?C.c[w-1].f[c]:0;Q&&(C.rt[Q-1]=C.c[w-1].f[c+v]||0,Q<17&&(I=[]));var S=a[C.rt[16]],k=C.rt[17]/512,E=2**(C.rt[18]-9)/K,b=C.rt[19],F=C.rt[20],N=43.23529*C.rt[21]*3.141592/44100,O=1-C.rt[22]/255,P=1e-5*C.rt[23],U=C.rt[24]/32,Y=C.rt[25]/512,J=6.283184*2**(C.rt[26]-9)/K,T=C.rt[27]/255,j=C.rt[28]*K&-2;for(m=(l*v+c)*K,f=0;f<4;++f)if(A=w?C.c[w-1].n[c+f*v]:0){I[A]||(I[A]=o(C,A,K));var q=I[A];for(u=0,h=2*m;u<q.length;u++,h+=2)M[h]+=q[u]}for(u=0;u<K;u++)(_=M[g=2*(m+u)])||B?(p=N,b&&(p*=S(E*g)*k+.5),L+=(p=1.5*Math.sin(p))*(y=O*(_-L)-(D+=p*L)),_=3==F?L:1==F?y:D,P&&(_=(_*=P)<1?_>-1?r(.25*_):-1:1,_/=P),B=(_*=U)*_>1e-5,x=_*(1-(d=Math.sin(J*g)*Y+.5)),_*=d):x=0,g>=j&&(x+=M[g-j+1]*T,_+=M[g-j]*T),M[g]=0|x,M[g+1]=0|_,i[g]+=0|x,i[g+1]+=0|_}return++e/t.At},this.wt=function(t){for(var n=t.createBuffer(2,s/2,44100),e=0;e<2;e++)for(var r=n.getChannelData(e),h=e;h<s;h+=2)r[h>>1]=i[h]/65536;return n}};const l={ct:[{rt:[0,91,128,0,0,95,128,12,0,0,12,0,72,0,0,0,0,0,0,0,2,255,0,0,32,83,3,130,4],ft:[1,2,1,2,,,,,,1,2,1,2,,,2,1,,,1,2,1,2],c:[{n:[135,,,,,,,,139,,,,142,,,,147,,,,,,,,139],f:[]},{n:[142,,,,,,,,147,,,,139,,,,135,,,,,,,,135],f:[]}]},{rt:[2,61,128,0,3,91,128,0,0,0,5,6,58,0,0,0,0,195,6,1,3,135,0,0,32,147,6,121,6],ft:[1,2,1,2,1,2,1,2,1,1,2,2,1,4,3,3,4,3,4,1,2,1,2],c:[{n:[,,,,135,,,,,,,,135,,,,,,,,147,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,154,,,,,,,,142,,,,,,,,142,,,,,,,,142],f:[]},{n:[,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,139,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,142,,,,,,,,154,,,,,,,,142,,,,,,,,142],f:[]},{n:[144,,,,,,,,144,,,,,,,,144,,,,,,,,144,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,139,,,,,,,,135,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]},{n:[144,,,,,,,,144,,,,,,,,156,,,,,,,,144,,,,,,,,139,,,,,,,,151,,,,,,,,139,,,,,,,,139,,,,,,,,147,,,,,,,,135,,,,,,,,135,,,,,,,,135],f:[]}]},{rt:[1,104,128,0,0,99,116,9,0,28,17,15,25,135,106,0,0,186,3,1,1,23,167,0,32,77,6,13,1],ft:[,,1,2,1,1,2,2,,1,2,,,3,4,3,3,4,4,4,1,2],c:[{n:[135,,139,,154,,147,,135,,139,,154,,151,,139,,142,,151,,,,139,,142,,154],f:[]},{n:[139,,142,,154,,,,139,,142,,154,,,,154,,151,,147,,,,154,,151,,147],f:[]},{n:[144,,139,,144,,151,,135,,139,147,147,,,,135,,139,147,147,,,,135,,139,156,156],f:[]},{n:[151,,139,,151,,139,,156,,144,151,151,,,,151,,144,151,147,,,,147,,139,147,135],f:[]}]}],ot:7350,ut:32,ht:22,At:3},c=function(){let t=new AudioContext,n=t.createGain();n.connect(t.destination);const e={},s=[{name:"song",data:l}];return{lt:()=>(s.forEach((n=>{let s=new u;s.init(n.data),function i(){if(1===s.lt()){let i=s.wt(t);((t,n)=>{e[t]=n})(n.name,i)}else setTimeout(i,0)}()})),new Promise((t=>{!function n(){Object.keys(e).length!==s.length?setTimeout(n,100):t()}()}))),play:(s,i=!1)=>{const r=e[s];if(!r)return;let h=t.createBufferSource(),o=t.createGain();return h.buffer=r,h.connect(o),o.connect(n),h.loop=i,o.gain.value=.8,h.start(),()=>{h.stop()}}}}();function f(t){let n;const e=s=>{n=new s,n.N({g:t,go:e}),n.init()};e(w),function(t){let n;const e=s=>{r.k=Math.min(20,Math.max(16,n?s-n:16))/1e3,n=s,t(),requestAnimationFrame(e)};requestAnimationFrame(e)}((()=>{n.update(),t.clear(),t.fr(0,0,64,64,"#1a001a"),t.fr(1,1,62,62,"#1f0f1f"),n.draw(t)}))}class A extends h{gt=!1;dt;get data(){return this.F}get g(){return this.data.g}go(t){this.data.go(t)}update(){a("m")?this.gt||(this.gt=!0,this.dt?(this.dt(),this.dt=void 0):this.dt=c.play("song",!0)):this.gt=!1,super.update()}}class w extends A{G(){s.load().then((()=>{let t=this.j(o,{name:"loading",tag:"audio",duration:1e3});t.x=32,t.y=32,c.lt().then((()=>{this.go(g)}))}))}}class g extends A{G(){this.j(m)}}class d extends h{x=0;y=0;draw(t){t.K(this.x,this.y),super.draw(t),t.pop()}}class _ extends d{G(){this.j(o,{name:"main_char"})}}class m extends h{o;_t=0;yt=0;G(){let t=s.h[0];this.o=[];for(let n=0;n<t.t;n++)this.o[n]=Array(t.w);for(let n=0;n<t.i.length;n++){let{px:e,src:s}=t.i[n],i=e[0]/8,r=e[1]/8,h=s[1]/8*10+s[0]/8;if(99===h){this._t=e[0]-32,this.yt=e[1]-32;let t=this.j(_);t.x=e[0],t.y=e[1]}else this.o[r][i]=h}}$(t){t.K(-this._t,-this.yt);for(let n=0;n<this.o.length;n++){let e=this.o[n];for(let s=0;s<e.length;s++){let i=e[s];t.S(i,8*s,8*n)}}}V(t){t.pop()}}!function(t){let n=function(t,n,e=!0){let s=document.createElement("canvas");e&&s.classList.add("pixelated");let r=s.getContext("2d");const h=()=>{s.width=t,s.height=n,r.imageSmoothingEnabled=e};return document.addEventListener("scroll",h,{capture:!0,passive:!0}),window.addEventListener("resize",h,{passive:!0}),h(),new i(s,r)}(64,64,!0);t.appendChild(n.canvas),f(n)}(document.getElementById("app"));
