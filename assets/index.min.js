const t=""+new URL("out_0-EgsLeeZI.png",import.meta.url).href,i=[{n:"Level_0",w:112,t:27,i:"AQR9AVQsVSxPMFAwUTBSMFMwVDBVME80UDRRNFI0UzRUNFU0UThSOFM4VDhVOGg8aTxqPGs8bDxtPG48bzxoQGlAakBrQGxAbUBuQG9AOEQ5RDpEO0Q8RD1EPkQ/REBEQURoRGlEakRrRGxEbURuRG9EOEg5SDpIO0g8SD1IPkg/SEBIQUhoSGlIakhrSGxIbUhuSG9IOEw5TEBMQUxnTGhMaUxqTGtMbExtTG5Mb0w4UEFQZVBmUGdQaFBpUGpQa1BsUG1QblBvUBdUGFQZVBpUG1QcVB1UHlQfVCBUKVQqVCtULFQtVC5UL1QwVFJUY1RkVGVUZlRnVGhUaVRqVGtUbFRtVG5Ub1QVWBZYF1gYWBlYGlgbWBxYHVgeWB9YIFgpWCpYK1gsWC1YLlgvWDBYT1hQWFFYUlhTWFRYVVhWWFdYWFhZWFpYW1hcWF1YXlhfWGBYYVhiWGNYZFhlWGZYZ1hoWGlYalhrWGxYbVhuWG9YAFwBXAJcA1wEXAVcBlwHXAhcCVwKXAtcDFwNXA5cD1wQXBFcElwTXBRcFVwWXBdcGFwZXBpcG1wcXB1cHlwfXCBcKVwqXCtcLFwtXC5cL1wwXE9cUFxRXFJcU1xUXFVcVlxXXFhcWVxaXFtcXFxdXF5cX1xgXGFcYlxjXGRcZVxmXGdcaFxpXGpca1xsXG1cblxvXABgAWACYANgBGAFYAZgB2AIYAlgCmALYAxgDWAOYA9gEGARYBJgE2AUYBVgFmAXYBhgGWAaYBtgHGAdYB5gH2AgYClgKmArYCxgLWAuYC9gMGAAZAFkAmQDZARkBWQGZAdkCGQJZApkC2QMZA1kDmQPZBBkEWQSZBNkFGQVZBZkF2QYZBlkGmQbZBxkHWQeZB9kIGQpZCpkK2QsZC1kLmQvZDBkAGgBaAJoA2gEaAVoBmgHaAhoCWgKaAtoDGgNaA5oD2gQaBFoEmgTaBRoFWgWaBdoGGgZaBpoG2gcaB1oHmgfaCBoKWgqaCtoLGgtaC5oL2gwaAAQBQBQODxMP0xAUEFUARAFAEJEOkw9TDlQOFQBDAMAaDhTVABYAAwLAFMsPEA+QEBAZ0hmTGRQFlRRVGJUFFgABBkATjBnME40ZzRnOGc8Z0A3RGdEN0g3TDdQPFAoVDdUPFQoWDxYTlgoXDxcTlwoYChkKGgBCDUATzhRPFI8UzxUPFU8BkAHQAhACUAKQAtADEBDRERERURGREdEO0w+TE9gUGBRYFJgU2BUYFVgVmBXYFhgWWBaYFtgXGBdYF5gX2BgYGFgYmBjYGRgZWBmYGdgaGBpYGpga2BsYG1gbmBvYAIEJgAAKAAsViwAMFYwaDAANFY0aDQAOFY4ADwAQABEAEhCSABMQkwAUD1QQlAAVCFUMVQ9VEJUIVgxWD1YIVwxXD1cIWAxYCFkMWQhaDFoAQBaAFQoVShPLFAsUSxSLGk4ajhrOGw4bThuOG84BjwHPAg8CTwKPAs8DDw4QDlAOkA7QD1AP0BBQEJAQ0BEQEVARkBHQGVMF1AYUBlQGlAbUBxQHVAeUB9QIFApUCpQK1AsUC1QLlAvUDBQUlBjUBVUT1RQVFRUVVRWVFdUWFRZVFpUW1RcVF1UXlRfVGBUYVQBWAJYA1gEWAVYBlgHWAhYCVgKWAtYDFgNWA5YD1gQWBFYElgTWAAICQBOOFA8BUA/UEBUN1hBWDxgTmACCAgAVjwNQEhEOlA5VDhYQlg9YAIACAAAJFYoaCwNPEhAIVAxUFNQAAANAFMoTixnLAU8N0BmSGRMFlAoUFFQYlAUVE5UBAgEAEA0QDg+PEA8BAQDAEAwPjg8PBNMAQAQVBFMHwBNCFEISxBPEFMQWxRfFGMUChgNGE0YURgIHA8cMSBPIFwgYiAGJDYkEChfKAYsEzAkMAY0MTRCNEc0ITgnOA=="},{n:"Level_1",w:73,t:37,i:"AQQRAAdwCHAJcApwC3AMcA1wDnAFdAZ0B3QIdAl0CnQLdAx0EHQAEAEAD3QBEAIADXQRdAEMAQAPcAAMAgAJbAZwAAQBAAR0AQgKAA50BXgGeAd4CHgJeAp4C3gMeBB4AQAMAAdsCGwKbAtsDGwNbA5sBHAFcBBwEXAScAAIAgAEeA94AggDABJ0DXgReAIAAQAPbAAAAQAGbAQEAQAJaAQAAQADcAUAAQATcAMAAQACcBNMAQAKZBFMAQARZA=="}];function s(t){function i(t){function i(t){return[4*(t%1024),4*Math.floor(t/1024)]}let s=[],n=function(t){const i=atob(t),s=i.length,n=new Uint8Array(s);for(let h=0;h<s;h++)n[h]=i.charCodeAt(h);return new Uint16Array(n.buffer)}(t);for(let h=0;h<n.length;){let t=n[h];h++;let e=n[h];h++;let a=[...n.slice(h,h+e)];h+=e,s.push(...a.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:n,t:h,i:e}=t;return{name:s,w:n,t:h,i:i(e)}}))}const n=new class{image;info;h;l;async load(){var n;this.image=await(n=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=n}))),this.info="bullet\n\n0*0*idle\n\n0*112*156\n\n\ncollect\n\n0*2*coin\n\n0*120*156\n0*128*156\n0*136*156\n\n\ncrash\n\n0*2*idle\n\n0*144*156\n0*152*156\n0*160*156\n\n\ncrawler\n\n0*1*idle\n\n0*168*156\n0*112*164\n\n\nflies\n\n0*7*idle\n8*13*run\n\n1*80*110\n1*96*110\n1*112*110\n1*128*110\n1*144*110\n1*160*110\n1*160*80\n1*160*30\n1*160*0\n1*80*60\n1*96*60\n1*112*60\n1*128*60\n1*144*60\n\n\nfx_collect\n\n0*2*idle\n\n0*120*164\n0*128*164\n0*136*164\n\n\nfx_djump\n\n0*1*idle\n\n0*144*164\n0*152*164\n\n\nfx_dust\n\n0*4*idle\n5*7*jump\n\n0*160*164\n0*168*164\n0*80*126\n0*88*126\n0*96*126\n0*104*126\n0*112*126\n0*120*126\n\n\nfx_flash\n\n0*1*idle\n\n0*128*126\n0*136*126\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*80*0\n4*80*30\n4*0*80\n4*80*80\n4*0*110\n\n\nmain_char\n\n0*2*idle\n3*6*victory\n7*12*run\n13*17*jump\n18*20*die\n\n0*144*126\n0*152*126\n0*160*126\n0*168*126\n0*160*96\n0*168*96\n0*160*46\n0*168*46\n0*160*16\n0*168*16\n0*0*172\n0*8*172\n0*16*172\n0*24*172\n0*32*172\n0*40*172\n0*48*172\n0*56*172\n0*64*172\n0*72*172\n0*80*172\n\n\nnpc\n\n0*0*idle\n\n3*0*140\n\n\nrestart\n\n0*2*idle\n3*6*bg\n\n1*48*140\n1*64*140\n1*80*140\n1*96*140\n1*112*140\n1*128*140\n1*144*140\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n1*160*140\n1*160*60\n1*0*156\n1*16*156\n1*32*156\n\n\ntiles\n\n0*0*idle\n\n2*0*0\n\n\nvictory\n\n0*3*idle\n\n1*48*156\n1*64*156\n1*80*156\n1*96*156".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,n]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,n]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:n}})),o:n.split(/\r?\n/).map((t=>{let[i,s,n,h,e,a,r,l]=function(t){let[i,s,n]=t,h=0,e=0,[a,r]=0===i?[8,8]:1===i?[16,16]:2===i?[80,80]:4===i?[80,30]:[0,0],[l,o]=[a,r];return[h,e,a,r,s,n,l,o]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,A:n,u:h,_:e,p:a,B:r,m:l}}))}})),this.l=this.info.find((t=>"tiles"===t.name)).o[0],this.h=s(i)}};class h{constructor(t,i){this.canvas=t,this.M=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{M:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,n,h){let{M:e}=this;e.fillStyle=h,e.fillRect(t,i,s,n)}F(t,i){let{M:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{M:t}=this;t.restore()}G(t,i,s,n=1,h=1){let{fx:e,fy:a,_:r,p:l,B:o,m:A}=t.U,{Y:c,V:d}=t,u=i-e-c,g=s-a-d;this.v(u,g,r,l,o,A,n,h)}D(t,i,s){let{fx:h,fy:e,_:a,p:r}=n.l,l=i-h,o=s-e,A=t%20*4,c=4*Math.floor(t/20);this.v(l,o,a+A,r+c,4,4)}v(t,i,s,h,e,a,r=1,l=1){let{M:o}=this,{image:A}=n;o.save();let c=e,d=a,u=c*Math.abs(r),g=d*Math.abs(l);o.scale(Number(r.toFixed(2)),Number(l.toFixed(2))),r<0&&(t*=-1,t-=u),l<0&&(i*=-1,i-=g),o.drawImage(A,s,h,c,d,Math.round(t),Math.round(i),Math.round(u),Math.round(g)),o.restore()}}const e={R:16,time:0,C(t,i=0){let{R:s,time:n}=this;return Math.floor((n-i-s)/t)<Math.floor((n-i)/t)}};class a{W;k(t){return this.W=t,this}visible=!0;parent;X;Z;I;T;P(t,i){this.T.push([t,i])}constructor(){this.I=[],this.Z=[],this.T=[]}L(t){return this.Z.filter((i=>i instanceof t))}N(t){return this.Z.find((i=>i instanceof t))}O(t,i){let s=(new t).k(i).init();return s.parent=this,s}j(t,i={}){let s=this.O(t,i);return this.Z.push(s),s}H(t,i={},s=7){let n=this.O(t,i);return this.Z.push(n),this.I.push([n,s]),n}remove(t){if(!t)return void(this.parent?this.parent.remove(this):this.J());let i=this.Z.indexOf(t);if(-1===i)throw"noscene rm";this.Z.splice(i,1),i=this.I.findIndex((([i])=>i===t)),-1!==i&&this.I.splice(i,1),t.J()}init(){return this.X=0,this.S(),this}update(){0===this.X&&this.K(),this.Z.forEach((t=>t.update())),this.X+=e.R,this.T=this.T.map((([t,i])=>(t-e.R<0&&i(),[t-e.R,i]))).filter((t=>t[0]>0)),this.I.slice(0).forEach((([t,i])=>{let s=this.I.filter((i=>i[0].constructor.name===t.constructor.name));if(s.length>i){let t=s[0][0];this.remove(t)}})),this.q(),this.$()}draw(t){this.visible&&(this.tt(t),this.Z.forEach((i=>i.draw(t))),this.it(t))}J(){this.st()}S(){}K(){}q(){}$(){}it(t){}tt(t){}st(){}}class r extends a{get data(){return this.W}get info(){let t=n.info.find((t=>t.name===this.nt));if(!t)throw`nosprite ${this.nt}`;return t}get duration(){return this.data.duration??.4}set duration(t){this.data.duration=t}get tag(){let t=this.info.tags.find((t=>t.name===this.ht));if(!t)throw`notag ${this.nt} ${this.ht}`;return t}get nt(){return this.data.name}get ht(){return this.data.tag||"idle"}x=0;y=0;et=1;rt=1;lt(t,i){this.x=t,this.y=i}_current_frame=0;get U(){let{from:t}=this.tag;return this.info.o[this._current_frame+t]}get ot(){return this.data.ot??"c"}get Y(){if("tl"===this.ot)return 0;let{A:t}=this.U;return"c"===this.ot||"bc"===this.ot?t/2:0}get V(){if("tl"===this.ot)return 0;let{u:t}=this.U;return"c"===this.ot?t/2:"bc"===this.ot?t:0}At(t){this.data.tag!==t&&(this.data.tag=t,this._current_frame=0,this.ct=0)}ct=0;q(){let{from:t,to:i}=this.tag,{duration:s}=this,n=s/(i-t+1),h=i-t;this.ct+=e.R,this.ct>=n&&(this.ct-=n,this._current_frame===h?!1!==this.data.loop&&(this._current_frame=0):this._current_frame+=1)}it(t){let{x:i,y:s,et:n,rt:h}=this;t.G(this,i,s,n,h)}}const l=function(){let t=new Set;return document.addEventListener("keydown",(i=>{return s=i.key,void t.add(s);var s})),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var o=function(){var t,i,s,n,h,e=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,i,s){var n,h,e,r,o,A,c=l[t.dt[0]],d=t.dt[1],u=t.dt[3]/32,g=l[t.dt[4]],f=t.dt[5],_=t.dt[8]/32,p=t.dt[9],B=t.dt[10]*t.dt[10]*4,m=t.dt[11]*t.dt[11]*4,w=t.dt[12]*t.dt[12]*4,x=1/w,Q=-t.dt[13]/16,M=t.dt[14],F=s*2**(2-t.dt[15]),G=new Int32Array(B+m+w),U=0,Y=0;for(n=0,h=0;n<B+m+w;n++,h++)h>=0&&(h-=F,o=a(i+(15&(M=M>>8|(255&M)<<4))+t.dt[2]-128),A=a(i+(15&M)+t.dt[6]-128)*(1+8e-4*t.dt[7])),e=1,n<B?e=n/B:n>=B+m&&(e=(1-(e=(n-B-m)*x))*3**(Q*e)),r=c(U+=o*e**u)*d,r+=g(Y+=A*e**_)*f,p&&(r+=(2*Math.random()-1)*p),G[n]=80*r*e|0;return G},l=[e,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(e){t=e,i=e.ut,s=0,n=e.gt*e.ft*(i+1)*2,h=new Int32Array(n)},this._t=function(){var a,o,A,c,d,u,g,f,_,p,B,m,w,x,Q=new Int32Array(n),M=t.Bt[s],F=t.gt,G=t.ft,U=0,Y=0,E=!1,V=[];for(A=0;A<=i;++A)for(g=M.wt[A],c=0;c<G;++c){var v=g?M.c[g-1].f[c]:0;v&&(M.dt[v-1]=M.c[g-1].f[c+G]||0,v<17&&(V=[]));var D=l[M.dt[16]],R=M.dt[17]/512,C=2**(M.dt[18]-9)/F,W=M.dt[19],k=M.dt[20],b=43.23529*M.dt[21]*3.141592/44100,y=1-M.dt[22]/255,X=1e-5*M.dt[23],Z=M.dt[24]/32,I=M.dt[25]/512,T=6.283184*2**(M.dt[26]-9)/F,P=M.dt[27]/255,L=M.dt[28]*F&-2;for(B=(A*G+c)*F,d=0;d<4;++d)if(u=g?M.c[g-1].n[c+d*G]:0){V[u]||(V[u]=r(M,u,F));var N=V[u];for(o=0,a=2*B;o<N.length;o++,a+=2)Q[a]+=N[o]}for(o=0;o<F;o++)(p=Q[f=2*(B+o)])||E?(m=b,W&&(m*=D(C*f)*R+.5),Y+=(m=1.5*Math.sin(m))*(w=y*(p-Y)-(U+=m*Y)),p=3==k?Y:1==k?w:U,X&&(p=(p*=X)<1?p>-1?e(.25*p):-1:1,p/=X),E=(p*=Z)*p>1e-5,x=p*(1-(_=Math.sin(T*f)*I+.5)),p*=_):x=0,f>=L&&(x+=Q[f-L+1]*P,p+=Q[f-L]*P),Q[f]=0|x,Q[f+1]=0|p,h[f]+=0|x,h[f+1]+=0|p}return++s/t.xt},this.Qt=function(t){for(var i=t.createBuffer(2,n/2,44100),s=0;s<2;s++)for(var e=i.getChannelData(s),a=s;a<n;a+=2)e[a>>1]=h[a]/65536;return i}};const A={Bt:[{dt:[1,130,128,0,1,128,116,9,0,25,6,22,34,0,0,0,0,69,3,0,2,23,167,0,32,77,6,25,6],wt:[1,2,1,2,,,1,2,1,2,1,2,,2,1],c:[{n:[135,139,142,135,139,142,135,139,142,135,139,142,135,139,142,135,141,144,139,141,144,139,141,144,139,141,144,139,141,144,139,141,147,,,147,,,147,,,147,,,147,,,147,,156,,,156,,,156,,,156,,,156],f:[]},{n:[142,146,137,142,146,137,142,146,137,142,146,137,142,146,137,140,144,135,140,144,135,140,144,135,140,144,135,140,144,135,140,144,154,,,154,,,154,,,154,,,154,,,152,,,152,,,152,,,152,,,152,,,152],f:[]}]},{dt:[0,68,128,0,3,91,128,6,0,0,25,40,101,37,102,0,1,55,8,0,1,53,61,26,27,84,6,144,4],wt:[,,2,2,,,,,,,,,,,,3],c:[{n:[],f:[]},{n:[135,,,,,,,,139,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,144,,,,,,,,139,,,,,,,,144,,,,,,,,142,,,,,,,,141,,,,,,,,142,,,,,,,,141],f:[]},{n:[135,,,,,,,,,,,,135,,,,,,,,,,,,135,,,,,,,,,,,,137,,,,,,,,,,,,139,,,,,,,,,,,,147],f:[]}]},{dt:[2,60,127,28,2,83,138,0,27,0,61,28,65,11,0,0,2,0,0,0,2,118,56,0,91,146,4,0,2],wt:[,,2,2,,,,,,,,,,,,3],c:[{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,147],f:[]}]},{dt:[3,255,116,79,0,255,116,0,83,123,4,6,69,52,0,0,0,184,11,1,2,14,0,0,32,0,0,0,0],wt:[,,,,2,2,2,1,2,2,1,1,,,2,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,135,,,135,,,135,,,,,,135,,,135,,,135],f:[]},{n:[,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141],f:[]}]},{dt:[0,39,117,24,0,51,110,0,64,0,4,6,35,0,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],wt:[,,,,,,,,,,,,,,,2,2],c:[{n:[],f:[]},{n:[,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151],f:[]}]},{dt:[0,0,140,0,0,0,140,0,0,81,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],wt:[,,,,2,,2,2,2,2,2,2,2,,2],c:[{n:[],f:[]},{n:[135,,,,,,147,,,,,,135,,,,,,147,,,,,,135,,,,,,147],f:[]}]},{dt:[0,51,128,64,0,59,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,32,2],wt:[,,,,,2,2,2,2,2,,,2,2],c:[{n:[],f:[]},{n:[,147,,,135,,,135,,,135,,,147,,,135,,,135,,,147,,,135,,,135,,,147],f:[]}]},{dt:[1,127,118,0,1,128,128,10,0,0,21,0,59,12,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],wt:[,,,,2,2,,,2,2,2,2,2],c:[{n:[],f:[]},{n:[135,139,142,135,139,142,135,139,142,135,139,142,135,139,142,135,141,144,139,141,144,139,141,144,139,141,144,139,141,144,139,141,147,,,147,,,147,,,147,,,147,,,147,,156,,,156,,,156,,,156,,,156],f:[]}]}],gt:6615,ft:32,ut:16,xt:8},c=t=>({Bt:[{dt:[1,109,120,0,0,53,120,4,0,0,15,0,48,15,50,2,1,0,0,0,2,255,96,0,37,24,1,67,1],wt:[1],c:[{n:[t],f:[22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]}]}],gt:5513,ft:32,ut:0,xt:1}),d=[c(151),c(161),c(171)],u={Bt:[{dt:[3,182,119,63,1,67,129,10,4,0,11,2,138,215,0,0,1,164,12,0,2,94,148,57,32,0,9,0,0],wt:[1],c:[{n:[137],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2]}]}],gt:5513,ft:32,ut:0,xt:1},g=t=>({Bt:[{dt:[0,100,125,0,0,201,131,2,0,0,5,0,39,0,134,3,0,195,6,0,2,44,60,1,39,0,10,0,0],wt:[1],c:[{n:[t],f:[]}]}],gt:5513,ft:32,ut:0,xt:1}),f=[g(135),g(147)],_=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},n=[{name:"song",data:A},{name:"pickup0",data:d[0]},{name:"pickup1",data:d[1]},{name:"pickup2",data:d[2]},{name:"damage",data:u},{name:"jump",data:f[0]},{name:"djump",data:f[1]}];return{_t:()=>(n.forEach((i=>{let n=new o;n.init(i.data),function h(){if(1===n._t()){let h=n.Qt(t);((t,i)=>{s[t]=i})(i.name,h)}else setTimeout(h,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==n.length?setTimeout(i,100):t()}()}))),play:(n,h=!1,e=.8)=>{const a=s[n];if(!a)return;let r=t.createBufferSource(),l=t.createGain();return r.buffer=a,r.connect(l),l.connect(i),r.loop=h,l.gain.value=e,r.start(),()=>{r.stop()}}}}();function p(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function B(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function m(t){let i;const s=n=>{i&&i.remove(),i=new n,i.k({g:t,go:s}),i.init()};s(x),function(t){let i;const s=n=>{e.R=Math.min(20,Math.max(16,i?n-i:16))/1e3,i=n,e.time+=e.R,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,64,64,"hsl(20, 5%, 50%)"),t.fr(1,1,62,62,"hsl(70, 15%, 30%)"),i.draw(t)}))}class w extends a{Mt=!1;Ft;get data(){return this.W}get g(){return this.data.g}go(t){this.data.go(t)}update(){l("m")?this.Mt||(this.Mt=!0,this.Ft?(this.Ft(),this.Ft=void 0):this.Ft=_.play("song",!0)):this.Mt=!1,super.update()}J(){console.log("here"),super.J(),this.Ft?.()}}class x extends w{S(){n.load().then((()=>{let t=this.j(r,{name:"loading",tag:"audio",duration:1});t.x=32,t.y=32,_._t().then((()=>{this.go(Q)}))}))}}class Q extends w{Gt;Ut;S(){this.Ft=_.play("song",!0,.1),this.Gt=this.j(X,{level:1}),this.Ut=this.j(M)}q(){this.Gt.N(C)&&l("r")&&this.go(Q),(this.Ut.N(F)?.X??0)>4&&(this.Gt.remove(),this.Ut.remove(),this.Ut=this.j(M),this.Gt=this.j(X,{level:2}))}}class M extends a{width=0;Yt=0;Et;Vt;vt(){this.Yt>0&&this.width++,this.Yt=.9,_.play("pickup"+Math.floor(3*Math.random()))}get done(){return this.width===this.Dt}S(){let t=this.j(r,{name:"collect",tag:"coin"});t.x=3,t.y=3}q(){if(this.Yt>0&&(this.Yt=p(this.Yt,0,3*e.R),this.Yt<.5&&(this.width++,this.Yt=0)),this.Et&&this.Et>0&&(this.Et=p(this.Et,0,3*e.R),0===this.Et)){this.Et=void 0;let t=this.j(r,{name:"restart",tag:"bg",duration:.8});t.x=32,t.y=32,this.Vt=this.j(r,{name:"restart",duration:5}),this.Vt.x=32,this.Vt.y=32}this.Vt&&(this.Vt.y=32+4*Math.sin(8*this.X))}Dt=0;it(t){t.fr(6,1,this.Dt,1,"#f7ffff"),t.fr(6,2,this.width,2,"#b4d800");let i=this.Yt/.9*1;t.fr(6+this.width,2,i,2,"#f59562")}}class F extends a{S(){let t=this.j(r,{name:"victory",duration:1});t.x=32,t.y=32}}class G extends a{get Rt(){return{x:this.x,y:this.y,w:this.w/2,t:this.t/2}}G;Ct=!0;Wt=1;kt=.8;w=4;t=4;grid;dx=0;dy=0;x=0;y=0;bt=0;yt=0;Xt=this.Zt;It;Tt;get Pt(){return Math.sign(this.dx)}get Lt(){return this.bt<0}get Zt(){return this.bt>0}get Nt(){return this.yt<0}get Ot(){return this.yt>0}draw(t){t.F(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}update(){super.update(),this.Xt=this.Zt}}class U extends G{Wt=0;get data(){return this.W}get duration(){return this.data.duration??1}S(){this.G=this.j(r,{name:this.data.name,tag:this.data.tag})}q(){this.X>this.duration&&this.remove()}}class Y extends U{Wt=.3;S(){this.G=this.j(r,{name:"crash"})}}class E extends G{jt}class V extends E{Wt=0;kt=64;Ht;S(){this.G=this.j(r,{name:"collect",tag:"coin",duration:.8})}q(){if(void 0!==this.Ht&&(this.Ht=p(this.Ht,0,e.R),this.Ht<2&&(e.C(.3)?this.visible&&(this.visible=!1):e.C(.1)&&(this.visible||(this.visible=!0))),0===this.Ht&&this.remove()),void 0!==this.jt){if(this.jt=p(this.jt,0,e.R),this.G.duration=.16,0===this.jt){let t=this.parent.j(U,{name:"fx_collect",duration:.3});t.x=this.x,t.y=this.y,this.remove()}}else this.dy=Math.sin(3*this.X)}}class v extends G{}class D extends v{w=8;t=8;S(){this.G=this.j(r,{name:"crawler"}),this.dx=1.2}q(){this.G.et=this.Pt}}class R extends G{Wt=0;S(){this.G=this.j(r,{name:"flies",duration:1})}}class C extends G{Wt=0;Ct=!1;S(){this.j(r,{name:"main_char",tag:"die",loop:!1})}}class W extends G{S(){this.j(r,{name:"main_char",tag:"victory"})}}class k extends G{w=8;t=8;Jt=0;St=0;Kt=2;zt=0;qt;$t=!1;ti=!1;S(){this.G=this.j(r,{name:"main_char"})}q(){if(this.Jt>0)return void(this.Jt=p(this.Jt,0,e.R));let t=l("x"),i=l("ArrowLeft")||l("a"),s=l("ArrowRight")||l("d"),n=l("ArrowUp")||l("w");if(this.$t=i,this.ti=s,this.dx=i?-8:s?8:0,n?void 0!==this.zt&&(this.zt+=e.R):void 0===this.zt?this.zt=0:this.zt>0&&(this.zt=-.3),void 0!==this.zt&&this.zt<0&&(this.zt+=e.R,this.zt>=0&&(this.zt=void 0)),void 0!==this.zt&&this.zt>0)if(void 0!==this.qt)this.dy=-40,this.zt=void 0,this.Kt=1,_.play("jump");else if(this.Kt>0){this.dy=-40,this.zt=void 0,this.Kt=0,_.play("djump");let t=this.parent.j(U,{name:"fx_djump",duration:.4});t.x=this.x,t.y=this.y+5}if(this.Zt?this.qt=0:this.Xt&&(this.qt=.16),void 0!==this.qt&&this.qt>0&&(this.qt=p(this.qt,0,e.R),0===this.qt&&(this.qt=void 0)),this.Zt?0!==this.dx?(this.G.At("run"),this.G.et=this.Pt):this.G.At("idle"):(this.G.At("jump"),0!==this.Pt&&(this.G.et=this.Pt)),t&&0===this.St){let t=this.parent.H(y,{dx:this.dx,dy:10});t.x=this.x,t.y=this.y,this.dx*=-6,this.St=.2}this.St=p(this.St,0,e.R)}$(){}}class b extends a{w=4;t=4;x;y;dx;dy;q(){this.dy=Math.sin(8*this.X)*Math.sin(16*this.X)*20,this.X>1.5&&this.remove()}draw(t){t.F(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}}class y extends b{get data(){return this.W}S(){this.dx=2*this.data.dx,this.dy=this.data.dy,this.j(r,{name:"bullet"})}}class X extends a{get data(){return this.W}get Ut(){return this.parent.N(M)}l;ii=0;si=0;ni=this.ii;hi=this.si;get ei(){return 4*this.l[0].length}ai(t,i,s){return!!this.ri(t,i,s)}ri(t,i,s){let{x:n,y:h,w:e,t:a}=t;return this.li(n-e/2+i,h-a/2+s,e,a)}li(t,i,s=1,n=1){let h=this.l[0].length,e=this.l.length,a=t/4,r=i/4,l=(t+s-1)/4,o=(i+n-1)/4;if(a<0||l>=h||r<0||o>=e)return!0;for(t=a;t<=l;t++)for(i=r;i<=o;i++)if(t=Math.floor(t),i=Math.floor(i),I(this.l[i][t]))return[4*t,4*i]}S(){let t=n.h[this.data.level-1];this.l=[];for(let s=0;s<t.t;s++)this.l[s]=Array(t.w);let i=0;for(let s=0;s<t.i.length;s++){let{px:n,src:h}=t.i[s],e=n[0]/4,a=n[1]/4,r=h[1]/4*20+h[0]/4;if(399===r){let t=this.j(k);t.x=n[0],t.y=n[1];let i=this.j(R);i.x=n[0],i.y=n[1]-8}else if(398===r){let t=this.j(D);t.x=n[0],t.y=n[1]}else if(397===r){let t=this.j(V);t.x=n[0],t.y=n[1],i++}else this.l[a][e]=r}this.oi=i}oi=0;K(){this.Ut.Dt=this.oi}q(){let t=this.N(k);if(t&&this.Ut.done){let i=this.j(W);i.x=t.x,i.y=t.y,t.remove(),this.N(R)?.remove(),this.Ut.j(F)}if(this.L(D).forEach((t=>{!this.ai(t,Math.sign(t.dx),0)&&this.ai(t,4*Math.sign(t.dx),1)||(t.dx*=-1)})),t&&0===t.Jt){this.Z.filter((t=>t instanceof E)).forEach((i=>{void 0===i.jt&&B(i,t)&&(i.jt=.3,i.dy=-8,this.Ut?.vt())})),this.Z.filter((t=>t instanceof v)).forEach((i=>{if(B(i.Rt,t.Rt)){if(0===this.Ut.width){t.remove();let i=this.j(C);i.x=t.x,i.y=t.y,this.Ut.Et=2}t.j(U,{name:"fx_flash"}),_.play("damage"),t.Jt=.6,t.dy=-32,0===t.dx?t.dx=6.4:t.dx=8*-Math.sign(t.dx)*.8;for(let i=0;i<this.Ut.width;i++){let s=this.j(V);s.x=t.x,s.y=t.y,s.dx=8*Math.sin(i/this.Ut.width*Math.PI*2),s.dy=80*Math.cos(i/this.Ut.width*Math.PI*2),s.Ht=5}this.Ut.width=0}}))}if(t&&void 0===t.It){let i=this.ai(t,0,2),s=this.ri(t,1,-1)?void 0:this.ri(t,1,0),n=this.ri(t,-1,-1)?void 0:this.ri(t,-1,0);i||(t.ti&&Array.isArray(s)?(t.It=.2,t.x=s[0],t.y=s[1]):t.$t&&Array.isArray(n)&&(t.It=-.2,t.x=n[0]+4,t.y=n[1]))}if(t&&!t.It&&void 0===t.Tt){let i=this.ri(t,1,-4)?void 0:this.ri(t,1,0),s=this.ri(t,-1,-4)?void 0:this.ri(t,-1,0);t.ti&&Array.isArray(i)?(t.Tt=.16,t.x=i[0],t.y=i[1]-1):t.$t&&Array.isArray(s)&&(t.Tt=-.16,t.x=s[0]+4,t.y=s[1]-1)}this.Z.filter((t=>t instanceof G)).forEach((t=>{let i=this.ri(t,0,0);if(void 0!==t.It)return t.It=p(t.It,0,e.R),void(0===t.It&&(t.It=void 0,t.y=i[1]-4,t.dy=0));if(void 0!==t.Tt)return t.Tt=p(t.Tt,0,e.R),void(0===t.Tt&&(t.Tt=void 0,t.y=i[1]-4,t.dy=0));let s=4*t.Wt,n=0;{let i=Math.abs(t.dy),h=Math.sign(t.dy);for(let a=0;a<i;a+=1){let r=.5*h*Math.sqrt(e.R);if(this.ai(t,0,r)){t.bt=h,t.dy/=2,n=0;break}t.bt=0,t.y+=r,n=1-h*(a/i);{let i=t.kt*s*Math.sqrt(n),h=1;t.dy+=h*i*e.R}}}{let i=3*s,n=1;for(let s=0;s<i;s+=1){let i=.5*n*Math.sqrt(e.R);if(this.ai(t,0,i)){t.bt=n,t.dy=0;break}t.bt=0,t.y+=i}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),n=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(e.R)*n;if(this.ai(t,i,0)){t.yt=s,t.dx=0;break}t.yt=0,t.x+=i}}}));let i=this.N(W),s=t||i;if(s&&(this.ni<s.x-4-1&&(this.ni=s.x-4-1),this.ni>s.x+4+1&&(this.ni=s.x+4+1),this.hi<s.y-8&&(this.hi=s.y-8),this.hi>s.y+8&&(this.hi=s.y+8)),s){let t=s.dx<0?-50:s.dx>0?-10:-32;this.ii=p(this.ii,this.ni+t,50*e.R),this.si=this.hi-32,this.ii=Math.min(Math.max(0,this.ii),this.ei)}this.N(C)&&(this.ii=p(this.ii,this.ii+8*Math.sin(9*this.X),8*e.R),this.si=p(this.si,this.si+8*Math.cos(9*this.X),8*e.R)),this.Z.filter((t=>t instanceof b)).forEach((t=>{{let i=Math.abs(t.dy),s=Math.sign(t.dy);for(let n=0;n<i;n+=1){let i=.5*s*Math.sqrt(e.R);if(this.ai(t,0,i)){t.dy/=2;break}t.y+=i;{let i=1,s=1;t.dy+=s*i*e.R}}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),n=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(e.R)*n;if(this.ai(t,i,0)){t.dx=0;let i=this.H(Y);i.x=t.x-2*s,i.y=t.y,i.G.et=s,this.remove(t);break}t.x+=i}}}));let n=this.N(R);n&&t&&(n.x=p(n.x,t.x+4*Math.cos(8*t.X),30*e.R),n.y=p(n.y,t.y-8+8*Math.sin(8*t.X),26*e.R),Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<=16?n.G.At("idle"):n.G.At("run"),n.G.et=t.G.et);let h="none";if(t&&t.Zt&&0!==t.dx&&e.C(.3+.5*Math.random())&&(h="idle"),t&&!t?.Xt&&t.Zt&&(h="jump"),t&&"none"!==h){let i=this.j(U,{name:"fx_dust",tag:h,duration:.4});i.x=t.x,"idle"===h&&(i.x+=4*-Math.sign(t.dx)),i.y=t.y,i.G.et=Math.max(1,Math.sign(t.dx))}}tt(t){t.F(-this.ii,-this.si);for(let i=0;i<this.l.length;i++){let s=this.l[i];for(let n=0;n<s.length;n++){let h=s[n];t.D(h,4*n,4*i)}}}it(t){t.pop()}}const Z=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],I=t=>Z.includes(t);!function(t){let i=function(t,i,s=!0){let n=document.createElement("canvas");s&&n.classList.add("pixelated");let e=n.getContext("2d");const a=()=>{n.width=t,n.height=i,e.imageSmoothingEnabled=s};return document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),a(),new h(n,e)}(64,64,!0);t.appendChild(i.canvas),m(i)}(document.getElementById("app"));
