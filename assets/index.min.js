const t=""+new URL("out_0-DY3J2XKr.png",import.meta.url).href,i=[{n:"Level_0",w:112,t:27,i:"AQR9AVQsVSxPMFAwUTBSMFMwVDBVME80UDRRNFI0UzRUNFU0UThSOFM4VDhVOGg8aTxqPGs8bDxtPG48bzxoQGlAakBrQGxAbUBuQG9AOEQ5RDpEO0Q8RD1EPkQ/REBEQURoRGlEakRrRGxEbURuRG9EOEg5SDpIO0g8SD1IPkg/SEBIQUhoSGlIakhrSGxIbUhuSG9IOEw5TEBMQUxnTGhMaUxqTGtMbExtTG5Mb0w4UEFQZVBmUGdQaFBpUGpQa1BsUG1QblBvUBdUGFQZVBpUG1QcVB1UHlQfVCBUKVQqVCtULFQtVC5UL1QwVFJUY1RkVGVUZlRnVGhUaVRqVGtUbFRtVG5Ub1QVWBZYF1gYWBlYGlgbWBxYHVgeWB9YIFgpWCpYK1gsWC1YLlgvWDBYT1hQWFFYUlhTWFRYVVhWWFdYWFhZWFpYW1hcWF1YXlhfWGBYYVhiWGNYZFhlWGZYZ1hoWGlYalhrWGxYbVhuWG9YAFwBXAJcA1wEXAVcBlwHXAhcCVwKXAtcDFwNXA5cD1wQXBFcElwTXBRcFVwWXBdcGFwZXBpcG1wcXB1cHlwfXCBcKVwqXCtcLFwtXC5cL1wwXE9cUFxRXFJcU1xUXFVcVlxXXFhcWVxaXFtcXFxdXF5cX1xgXGFcYlxjXGRcZVxmXGdcaFxpXGpca1xsXG1cblxvXABgAWACYANgBGAFYAZgB2AIYAlgCmALYAxgDWAOYA9gEGARYBJgE2AUYBVgFmAXYBhgGWAaYBtgHGAdYB5gH2AgYClgKmArYCxgLWAuYC9gMGAAZAFkAmQDZARkBWQGZAdkCGQJZApkC2QMZA1kDmQPZBBkEWQSZBNkFGQVZBZkF2QYZBlkGmQbZBxkHWQeZB9kIGQpZCpkK2QsZC1kLmQvZDBkAGgBaAJoA2gEaAVoBmgHaAhoCWgKaAtoDGgNaA5oD2gQaBFoEmgTaBRoFWgWaBdoGGgZaBpoG2gcaB1oHmgfaCBoKWgqaCtoLGgtaC5oL2gwaAAQBQBQODxMP0xAUEFUARAFAEJEOkw9TDlQOFQBDAMAaDhTVABYAAwIAFMsZ0hmTGRQFlRRVGJUFFgABBwATjBnME40ZzRnOGc8Z0A3RGdEN0g3TDdQPFAoVDdUPFQoWDxYTlgoXDxcTlwoYDxgKGQ8ZChoPGgBCDUATzhRPFI8UzxUPFU8BkAHQAhACUAKQAtADEBDRERERURGREdEO0w+TE9gUGBRYFJgU2BUYFVgVmBXYFhgWWBaYFtgXGBdYF5gX2BgYGFgYmBjYGRgZWBmYGdgaGBpYGpga2BsYG1gbmBvYAIEKQAAKAAsViwAMFYwaDAANFY0aDQAOFY4ADwAQABEAEhCSABMQkwAUD1QQlAAVCFUMVQ9VEJUIVgxWD1YIVwxXD1cIWAxYD1gIWQxZD1kIWgxaD1oAQBdAFQoVShPLFAsUSxSLGk4ajhrOGw4bThuOG84BjwHPAg8CTwKPAs8DDw4QDlAOkA7QDxAPUA+QD9AQEBBQEJAQ0BEQEVARkBHQGVMF1AYUBlQGlAbUBxQHVAeUB9QIFApUCpQK1AsUC1QLlAvUDBQUlBjUBVUT1RQVFRUVVRWVFdUWFRZVFpUW1RcVF1UXlRfVGBUYVQBWAJYA1gEWAVYBlgHWAhYCVgKWAtYDFgNWA5YD1gQWBFYElgTWAAICABOOFA8BUA/UEBUN1hBWE5gAggHAFY8DUBIRDpQOVQ4WEJYAgAIAAAkVihoLA08SEAhUDFQU1AAAA0AUyhOLGcsBTw3QGZIZEwWUChQUVBiUBRUTlQTTAEAEFQRTB8ATQhRCEsQTxBTEFsUXxRjFAoYDRhNGFEYCBwPHDEgTyBcIGIgBiQ2JBAoXygGLBMwJDAGNDE0QjRHNCE4Jzg="}];function s(t){function i(t){function i(t){return[4*(t%1024),4*Math.floor(t/1024)]}let s=[],n=function(t){const i=atob(t),s=i.length,n=new Uint8Array(s);for(let h=0;h<s;h++)n[h]=i.charCodeAt(h);return new Uint16Array(n.buffer)}(t);for(let h=0;h<n.length;){let t=n[h];h++;let e=n[h];h++;let a=[...n.slice(h,h+e)];h+=e,s.push(...a.map((s=>({src:i(t),px:i(s)}))))}return s}return t.map((t=>{let{n:s,w:n,t:h,i:e}=t;return{name:s,w:n,t:h,i:i(e)}}))}const n=new class{image;info;h;l;async load(){var n;this.image=await(n=t,new Promise((t=>{let i=new Image;i.onload=()=>t(i),i.src=n}))),this.info="bullet\n\n0*0*idle\n\n0*144*156\n\n\ncollect\n\n0*2*coin\n\n0*152*156\n0*160*156\n0*144*164\n\n\ncrash\n\n0*2*idle\n\n0*152*164\n0*160*164\n0*160*140\n\n\ncrawler\n\n0*1*idle\n\n0*160*148\n0*160*60\n\n\nflies\n\n0*7*idle\n8*13*run\n\n1*80*110\n1*96*110\n1*112*110\n1*128*110\n1*144*110\n1*80*60\n1*96*60\n1*112*60\n1*128*60\n1*144*60\n1*0*140\n1*16*140\n1*32*140\n1*48*140\n\n\nfx_collect\n\n0*2*idle\n\n0*160*68\n0*160*110\n0*160*118\n\n\nfx_djump\n\n0*1*idle\n\n0*80*126\n0*88*126\n\n\nfx_flash\n\n0*1*idle\n\n0*96*126\n0*104*126\n\n\nloading\n\n0*1*audio\n2*4*input\n\n4*80*0\n4*80*30\n4*0*80\n4*80*80\n4*0*110\n\n\nmain_char\n\n0*2*idle\n3*8*run\n9*13*jump\n14*16*die\n\n0*112*126\n0*120*126\n0*128*126\n0*136*126\n0*144*126\n0*152*126\n0*160*126\n0*160*80\n0*160*88\n0*160*96\n0*160*30\n0*160*38\n0*160*46\n0*160*0\n0*160*8\n0*160*16\n0*0*172\n\n\nnpc\n\n0*0*idle\n\n3*64*140\n\n\nrestart\n\n0*2*idle\n3*6*bg\n\n1*112*140\n1*128*140\n1*144*140\n1*0*156\n1*16*156\n1*32*156\n1*48*156\n\n\ntest\n\n0*2*idle\n3*4*attack\n\n1*64*156\n1*80*156\n1*96*156\n1*112*156\n1*128*156\n\n\ntiles\n\n0*0*idle\n\n2*0*0".split(/\r?\n\r?\n\r?\n/).map((t=>{let[i,s,n]=t.split(/\r?\n\r?\n/);return{name:i,tags:s.split(/\r?\n/).map((t=>{let[i,s,n]=t.split("*");return{from:parseInt(i),to:parseInt(s),name:n}})),o:n.split(/\r?\n/).map((t=>{let[i,s,n,h,e,a,r,l]=function(t){let[i,s,n]=t,h=0,e=0,[a,r]=0===i?[8,8]:1===i?[16,16]:2===i?[80,80]:4===i?[80,30]:[0,0],[l,o]=[a,r];return[h,e,a,r,s,n,l,o]}(t.split("*").map((t=>parseInt(t))));return{fx:i,fy:s,u:n,A:h,_:e,p:a,B:r,m:l}}))}})),this.l=this.info.find((t=>"tiles"===t.name)).o[0],console.log(this.info),this.h=s(i)}};class h{constructor(t,i){this.canvas=t,this.F=i}get width(){return this.canvas.width}get height(){return this.canvas.height}clear(){let{F:t}=this;t.clearRect(0,0,this.width,this.height)}fr(t,i,s,n,h){let{F:e}=this;e.fillStyle=h,e.fillRect(t,i,s,n)}M(t,i){let{F:s}=this;s.save(),s.translate(Math.floor(t),Math.floor(i))}pop(){let{F:t}=this;t.restore()}U(t,i,s,n=1,h=1){let{fx:e,fy:a,_:r,p:l,B:o,m:c}=t.G,{Y:d,V:u}=t,g=i-e-d,f=s-a-u;this.v(g,f,r,l,o,c,n,h)}D(t,i,s){let{fx:h,fy:e,_:a,p:r}=n.l,l=i-h,o=s-e,c=t%20*4,d=4*Math.floor(t/20);this.v(l,o,a+c,r+d,4,4)}v(t,i,s,h,e,a,r=1,l=1){let{F:o}=this,{image:c}=n;o.save();let d=e,u=a,g=d*Math.abs(r),f=u*Math.abs(l);o.scale(Number(r.toFixed(2)),Number(l.toFixed(2))),r<0&&(t*=-1,t-=g),l<0&&(i*=-1,i-=f),o.drawImage(c,s,h,d,u,Math.round(t),Math.round(i),Math.round(g),Math.round(f)),o.restore()}}const e={W:16,time:0,R(t,i=0){let{W:s,time:n}=this;return Math.floor((n-i-s)/t)<Math.floor((n-i)/t)}};class a{k;C(t){return this.k=t,this}visible=!0;parent;X;Z;T;I;L(t,i){this.I.push([t,i])}constructor(){this.T=[],this.Z=[],this.I=[]}O(t){return this.Z.filter((i=>i instanceof t))}P(t){return this.Z.find((i=>i instanceof t))}H(t,i){let s=(new t).C(i).init();return s.parent=this,s}J(t,i={}){let s=this.H(t,i);return this.Z.push(s),s}K(t,i={},s=7){let n=this.H(t,i);return this.Z.push(n),this.T.push([n,s]),n}remove(t){if(!t)return void(this.parent?this.parent.remove(this):this.N());let i=this.Z.indexOf(t);if(-1===i)throw"noscene rm";this.Z.splice(i,1),i=this.T.findIndex((([i])=>i===t)),-1!==i&&this.T.splice(i,1),t.N()}init(){return this.X=0,this.S(),this}update(){0===this.X&&this.j(),this.Z.forEach((t=>t.update())),this.X+=e.W,this.I=this.I.map((([t,i])=>(t-e.W<0&&i(),[t-e.W,i]))).filter((t=>t[0]>0)),this.T.slice(0).forEach((([t,i])=>{let s=this.T.filter((i=>i[0].constructor.name===t.constructor.name));if(s.length>i){let t=s[0][0];this.remove(t)}})),this.q(),this.$()}draw(t){this.visible&&(this.tt(t),this.Z.forEach((i=>i.draw(t))),this.it(t))}N(){this.st()}S(){}j(){}q(){}$(){}it(t){}tt(t){}st(){}}class r extends a{get data(){return this.k}get info(){let t=n.info.find((t=>t.name===this.nt));if(!t)throw`nosprite ${this.nt}`;return t}get duration(){return this.data.duration??.4}set duration(t){this.data.duration=t}get tag(){let t=this.info.tags.find((t=>t.name===this.ht));if(!t)throw`notag ${this.nt} ${this.ht}`;return t}get nt(){return this.data.name}get ht(){return this.data.tag||"idle"}x=0;y=0;et=1;rt=1;lt(t,i){this.x=t,this.y=i}_current_frame=0;get G(){let{from:t}=this.tag;return this.info.o[this._current_frame+t]}get ot(){return this.data.ot??"c"}get Y(){if("tl"===this.ot)return 0;let{u:t}=this.G;return"c"===this.ot||"bc"===this.ot?t/2:0}get V(){if("tl"===this.ot)return 0;let{A:t}=this.G;return"c"===this.ot?t/2:"bc"===this.ot?t:0}ct(t){this.data.tag!==t&&(this.data.tag=t,this._current_frame=0,this.dt=0)}dt=0;q(){let{from:t,to:i}=this.tag,{duration:s}=this,n=s/(i-t+1),h=i-t;this.dt+=e.W,this.dt>=n&&(this.dt-=n,this._current_frame===h?!1!==this.data.loop&&(this._current_frame=0):this._current_frame+=1)}it(t){let{x:i,y:s,et:n,rt:h}=this;t.U(this,i,s,n,h)}}const l=function(){let t=new Set;return document.addEventListener("keydown",(i=>{return s=i.key,void t.add(s);var s})),document.addEventListener("keyup",(i=>{return s=i.key,void t.delete(s);var s})),i=>[...t].includes(i)}();var o=function(){var t,i,s,n,h,e=function(t){return Math.sin(6.283184*t)},a=function(t){return.003959503758*2**((t-128)/12)},r=function(t,i,s){var n,h,e,r,o,c,d=l[t.ut[0]],u=t.ut[1],g=t.ut[3]/32,f=l[t.ut[4]],A=t.ut[5],_=t.ut[8]/32,p=t.ut[9],B=t.ut[10]*t.ut[10]*4,x=t.ut[11]*t.ut[11]*4,w=t.ut[12]*t.ut[12]*4,m=1/w,Q=-t.ut[13]/16,F=t.ut[14],M=s*2**(2-t.ut[15]),U=new Int32Array(B+x+w),G=0,Y=0;for(n=0,h=0;n<B+x+w;n++,h++)h>=0&&(h-=M,o=a(i+(15&(F=F>>8|(255&F)<<4))+t.ut[2]-128),c=a(i+(15&F)+t.ut[6]-128)*(1+8e-4*t.ut[7])),e=1,n<B?e=n/B:n>=B+x&&(e=(1-(e=(n-B-x)*m))*3**(Q*e)),r=d(G+=o*e**g)*u,r+=f(Y+=c*e**_)*A,p&&(r+=(2*Math.random()-1)*p),U[n]=80*r*e|0;return U},l=[e,function(t){return t%1<.5?1:-1},function(t){return t%1*2-1},function(t){var i=t%1*4;return i<2?i-1:3-i}];this.init=function(e){t=e,i=e.gt,s=0,n=e.ft*e.At*(i+1)*2,h=new Int32Array(n)},this._t=function(){var a,o,c,d,u,g,f,A,_,p,B,x,w,m,Q=new Int32Array(n),F=t.Bt[s],M=t.ft,U=t.At,G=0,Y=0,V=!1,v=[];for(c=0;c<=i;++c)for(f=F.xt[c],d=0;d<U;++d){var D=f?F.c[f-1].f[d]:0;D&&(F.ut[D-1]=F.c[f-1].f[d+U]||0,D<17&&(v=[]));var E=l[F.ut[16]],W=F.ut[17]/512,R=2**(F.ut[18]-9)/M,k=F.ut[19],y=F.ut[20],b=43.23529*F.ut[21]*3.141592/44100,C=1-F.ut[22]/255,X=1e-5*F.ut[23],Z=F.ut[24]/32,T=F.ut[25]/512,I=6.283184*2**(F.ut[26]-9)/M,L=F.ut[27]/255,O=F.ut[28]*M&-2;for(B=(c*U+d)*M,u=0;u<4;++u)if(g=f?F.c[f-1].n[d+u*U]:0){v[g]||(v[g]=r(F,g,M));var P=v[g];for(o=0,a=2*B;o<P.length;o++,a+=2)Q[a]+=P[o]}for(o=0;o<M;o++)(p=Q[A=2*(B+o)])||V?(x=b,k&&(x*=E(R*A)*W+.5),Y+=(x=1.5*Math.sin(x))*(w=C*(p-Y)-(G+=x*Y)),p=3==y?Y:1==y?w:G,X&&(p=(p*=X)<1?p>-1?e(.25*p):-1:1,p/=X),V=(p*=Z)*p>1e-5,m=p*(1-(_=Math.sin(I*A)*T+.5)),p*=_):m=0,A>=O&&(m+=Q[A-O+1]*L,p+=Q[A-O]*L),Q[A]=0|m,Q[A+1]=0|p,h[A]+=0|m,h[A+1]+=0|p}return++s/t.wt},this.Qt=function(t){for(var i=t.createBuffer(2,n/2,44100),s=0;s<2;s++)for(var e=i.getChannelData(s),a=s;a<n;a+=2)e[a>>1]=h[a]/65536;return i}};const c={Bt:[{ut:[1,130,128,0,1,128,116,9,0,25,6,22,34,0,0,0,0,69,3,0,2,23,167,0,32,77,6,25,6],xt:[1,2,1,2,,,1,2,1,2,1,2,,2,1],c:[{n:[135,139,142,135,139,142,135,139,142,135,139,142,135,139,142,135,141,144,139,141,144,139,141,144,139,141,144,139,141,144,139,141,147,,,147,,,147,,,147,,,147,,,147,,156,,,156,,,156,,,156,,,156],f:[]},{n:[142,146,137,142,146,137,142,146,137,142,146,137,142,146,137,140,144,135,140,144,135,140,144,135,140,144,135,140,144,135,140,144,154,,,154,,,154,,,154,,,154,,,152,,,152,,,152,,,152,,,152,,,152],f:[]}]},{ut:[0,68,128,0,3,91,128,6,0,0,25,40,101,37,102,0,1,55,8,0,1,53,61,26,27,84,6,144,4],xt:[,,2,2,,,,,,,,,,,,3],c:[{n:[],f:[]},{n:[135,,,,,,,,139,,,,,,,,135,,,,,,,,139,,,,,,,,151,,,,,,,,144,,,,,,,,139,,,,,,,,144,,,,,,,,142,,,,,,,,141,,,,,,,,142,,,,,,,,141],f:[]},{n:[135,,,,,,,,,,,,135,,,,,,,,,,,,135,,,,,,,,,,,,137,,,,,,,,,,,,139,,,,,,,,,,,,147],f:[]}]},{ut:[2,60,127,28,2,83,138,0,27,0,61,28,65,11,0,0,2,0,0,0,2,118,56,0,91,146,4,0,2],xt:[,,2,2,,,,,,,,,,,,3],c:[{n:[],f:[]},{n:[135,,,,,,,,,,,,,,,,135],f:[]},{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,147,,,,,,,,,,,,,,,,147],f:[]}]},{ut:[3,255,116,79,0,255,116,0,83,123,4,6,69,52,0,0,0,184,11,1,2,14,0,0,32,0,0,0,0],xt:[,,,,2,2,2,1,2,2,1,1,,,2,,1],c:[{n:[,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,135,,,,,,135,,,135,,,135,,,,,,135,,,135,,,135],f:[]},{n:[,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141,,,141],f:[]}]},{ut:[0,39,117,24,0,51,110,0,64,0,4,6,35,0,0,0,0,0,0,0,2,14,0,1,39,76,5,0,0],xt:[,,,,,,,,,,,,,,,2,2],c:[{n:[],f:[]},{n:[,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151,,151],f:[]}]},{ut:[0,0,140,0,0,0,140,0,0,81,4,10,47,55,0,0,0,187,5,0,1,239,135,0,32,108,5,16,4],xt:[,,,,2,,2,2,2,2,2,2,2,,2],c:[{n:[],f:[]},{n:[135,,,,,,147,,,,,,135,,,,,,147,,,,,,135,,,,,,147],f:[]}]},{ut:[0,51,128,64,0,59,128,0,64,210,4,7,52,85,0,0,0,60,4,1,2,255,0,0,32,61,5,32,2],xt:[,,,,,2,2,2,2,2,,,2,2],c:[{n:[],f:[]},{n:[,147,,,135,,,135,,,135,,,147,,,135,,,135,,,147,,,135,,,135,,,147],f:[]}]},{ut:[1,127,118,0,1,128,128,10,0,0,21,0,59,12,0,0,0,69,3,1,1,23,167,0,32,77,6,25,6],xt:[,,,,2,2,,,2,2,2,2,2],c:[{n:[],f:[]},{n:[135,139,142,135,139,142,135,139,142,135,139,142,135,139,142,135,141,144,139,141,144,139,141,144,139,141,144,139,141,144,139,141,147,,,147,,,147,,,147,,,147,,,147,,156,,,156,,,156,,,156,,,156],f:[]}]}],ft:6615,At:32,gt:16,wt:8},d=t=>({Bt:[{ut:[1,109,120,0,0,53,120,4,0,0,15,0,48,15,50,2,1,0,0,0,2,255,96,0,37,24,1,67,1],xt:[1],c:[{n:[t],f:[22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,255]}]}],ft:5513,At:32,gt:0,wt:1}),u=[d(151),d(161),d(171)],g={Bt:[{ut:[3,182,119,63,1,67,129,10,4,0,11,2,138,215,0,0,1,164,12,0,2,94,148,57,32,0,9,0,0],xt:[1],c:[{n:[137],f:[21,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,2]}]}],ft:5513,At:32,gt:0,wt:1},f=function(){let t=new AudioContext,i=t.createGain();i.connect(t.destination);const s={},n=[{name:"song",data:c},{name:"pickup0",data:u[0]},{name:"pickup1",data:u[1]},{name:"pickup2",data:u[2]},{name:"damage",data:g}];return{_t:()=>(n.forEach((i=>{let n=new o;n.init(i.data),function h(){if(1===n._t()){let h=n.Qt(t);((t,i)=>{s[t]=i})(i.name,h)}else setTimeout(h,0)}()})),new Promise((t=>{!function i(){Object.keys(s).length!==n.length?setTimeout(i,100):t()}()}))),play:(n,h=!1,e=.8)=>{const a=s[n];if(!a)return;let r=t.createBufferSource(),l=t.createGain();return r.buffer=a,r.connect(l),l.connect(i),r.loop=h,l.gain.value=e,r.start(),()=>{r.stop()}}}}();function A(t,i,s){return t<i?Math.min(t+s,i):t>i?Math.max(t-s,i):t}function _(t,i){return t.x<i.x+i.w&&t.x+t.w>i.x&&t.y<i.y+i.t&&t.y+t.t>i.y}function p(t){let i;const s=n=>{i&&i.remove(),i=new n,i.C({g:t,go:s}),i.init()};s(x),function(t){let i;const s=n=>{e.W=Math.min(20,Math.max(16,i?n-i:16))/1e3,i=n,e.time+=e.W,t(),requestAnimationFrame(s)};requestAnimationFrame(s)}((()=>{i.update(),t.clear(),t.fr(0,0,64,64,"hsl(20, 5%, 50%)"),t.fr(1,1,62,62,"hsl(70, 15%, 30%)"),i.draw(t)}))}class B extends a{Ft=!1;Mt;get data(){return this.k}get g(){return this.data.g}go(t){this.data.go(t)}update(){l("m")?this.Ft||(this.Ft=!0,this.Mt?(this.Mt(),this.Mt=void 0):this.Mt=f.play("song",!0)):this.Ft=!1,super.update()}N(){console.log("here"),super.N(),this.Mt?.()}}class x extends B{S(){n.load().then((()=>{let t=this.J(r,{name:"loading",tag:"audio",duration:1});t.x=32,t.y=32,f._t().then((()=>{this.go(w)}))}))}}class w extends B{Ut;S(){this.Mt=f.play("song",!0,.1),this.Ut=this.J(k),this.J(m)}q(){this.Ut.P(D)&&l("r")&&this.go(w)}}class m extends a{width=0;Gt=0;Yt;Vt;vt(){this.Gt=.9,f.play("pickup"+Math.floor(3*Math.random()))}S(){let t=this.J(r,{name:"collect",tag:"coin"});t.x=3,t.y=3}q(){if(this.Gt>0&&(this.Gt=A(this.Gt,0,3*e.W),this.Gt<.5&&(this.width++,this.Gt=0)),this.Yt&&this.Yt>0&&(this.Yt=A(this.Yt,0,3*e.W),0===this.Yt)){this.Yt=void 0;let t=this.J(r,{name:"restart",tag:"bg",duration:.8});t.x=32,t.y=32,this.Vt=this.J(r,{name:"restart",duration:5}),this.Vt.x=32,this.Vt.y=32}this.Vt&&(this.Vt.y=32+4*Math.sin(8*this.X))}it(t){t.fr(6,1,54,1,"#f7ffff"),t.fr(6,2,this.width,2,"#b4d800");let i=this.Gt/.9*1;t.fr(6+this.width,2,i,2,"#f59562")}}class Q extends a{get Dt(){return{x:this.x,y:this.y,w:this.w/2,t:this.t/2}}U;Et=!0;Wt=1;Rt=.8;w=4;t=4;grid;dx=0;dy=0;x=0;y=0;kt=0;yt=0;bt=this.Ct;Xt;Zt;get Tt(){return Math.sign(this.dx)}get It(){return this.kt<0}get Ct(){return this.kt>0}get Lt(){return this.yt<0}get Ot(){return this.yt>0}draw(t){t.M(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}update(){super.update(),this.bt=this.Ct}}class F extends Q{Wt=0;get data(){return this.k}get duration(){return this.data.duration??1}S(){this.U=this.J(r,{name:this.data.name})}q(){this.X>this.duration&&this.remove()}}class M extends F{Wt=.3;S(){this.U=this.J(r,{name:"crash"})}}class U extends Q{Pt}class G extends U{Wt=0;Rt=64;Ht;S(){this.U=this.J(r,{name:"collect",tag:"coin",duration:.8})}q(){if(void 0!==this.Ht&&(this.Ht=A(this.Ht,0,e.W),this.Ht<2&&(e.R(.3)?this.visible&&(this.visible=!1):e.R(.1)&&(this.visible||(this.visible=!0))),0===this.Ht&&this.remove()),void 0!==this.Pt){if(this.Pt=A(this.Pt,0,e.W),this.U.duration=.16,0===this.Pt){let t=this.parent.J(F,{name:"fx_collect",duration:.3});t.x=this.x,t.y=this.y,this.remove()}}else this.dy=Math.sin(3*this.X)}}class Y extends Q{}class V extends Y{w=8;t=8;S(){this.U=this.J(r,{name:"crawler"}),this.dx=1.2}q(){this.U.et=this.Tt}}class v extends Q{Wt=0;S(){this.U=this.J(r,{name:"flies",duration:1})}}class D extends Q{Wt=0;Et=!1;S(){this.J(r,{name:"main_char",tag:"die",loop:!1})}}class E extends Q{w=8;t=8;Jt=0;Kt=0;Nt=2;St=0;jt;zt=!1;qt=!1;S(){this.U=this.J(r,{name:"main_char"})}q(){if(this.Jt>0)return void(this.Jt=A(this.Jt,0,e.W));let t=l("x"),i=l("ArrowLeft")||l("a"),s=l("ArrowRight")||l("d"),n=l("ArrowUp")||l("w");if(this.zt=i,this.qt=s,this.dx=i?-8:s?8:0,n?void 0!==this.St&&(this.St+=e.W):void 0===this.St?this.St=0:this.St>0&&(this.St=-.3),void 0!==this.St&&this.St<0&&(this.St+=e.W,this.St>=0&&(this.St=void 0)),void 0!==this.St&&this.St>0)if(void 0!==this.jt)this.dy=-40,this.St=void 0,this.Nt=1;else if(this.Nt>0){this.dy=-40,this.St=void 0,this.Nt=0;let t=this.parent.J(F,{name:"fx_djump",duration:.4});t.x=this.x,t.y=this.y+5}if(this.Ct?this.jt=0:this.bt&&(this.jt=.16),void 0!==this.jt&&this.jt>0&&(this.jt=A(this.jt,0,e.W),0===this.jt&&(this.jt=void 0)),this.Ct?0!==this.dx?(this.U.ct("run"),this.U.et=this.Tt):this.U.ct("idle"):(this.U.ct("jump"),0!==this.Tt&&(this.U.et=this.Tt)),t&&0===this.Kt){let t=this.parent.K(R,{dx:this.dx,dy:10});t.x=this.x,t.y=this.y,this.dx*=-6,this.Kt=.2}this.Kt=A(this.Kt,0,e.W)}$(){}}class W extends a{w=4;t=4;x;y;dx;dy;q(){this.dy=Math.sin(8*this.X)*Math.sin(16*this.X)*20,this.X>1.5&&this.remove()}draw(t){t.M(Math.floor(this.x),Math.floor(this.y)),super.draw(t),t.pop()}}class R extends W{get data(){return this.k}S(){this.dx=2*this.data.dx,this.dy=this.data.dy,this.J(r,{name:"bullet"})}}class k extends a{get $t(){return this.parent.P(m)}l;ti=0;ii=0;si=this.ti;ni=this.ii;get hi(){return 4*this.l[0].length}ei(t,i,s){return!!this.ai(t,i,s)}ai(t,i,s){let{x:n,y:h,w:e,t:a}=t;return this.ri(n-e/2+i,h-a/2+s,e,a)}ri(t,i,s=1,n=1){let h=this.l[0].length,e=this.l.length,a=t/4,r=i/4,l=(t+s-1)/4,o=(i+n-1)/4;if(a<0||l>=h||r<0||o>=e)return!0;for(t=a;t<=l;t++)for(i=r;i<=o;i++)if(t=Math.floor(t),i=Math.floor(i),b(this.l[i][t]))return[4*t,4*i]}S(){let t=n.h[0];this.l=[];for(let i=0;i<t.t;i++)this.l[i]=Array(t.w);for(let i=0;i<t.i.length;i++){let{px:s,src:n}=t.i[i],h=s[0]/4,e=s[1]/4,a=n[1]/4*20+n[0]/4;if(399===a){let t=this.J(E);t.x=s[0],t.y=s[1];let i=this.J(v);i.x=s[0],i.y=s[1]-8}else if(398===a){let t=this.J(V);t.x=s[0],t.y=s[1]}else if(397===a){let t=this.J(G);t.x=s[0],t.y=s[1]}else this.l[e][h]=a}}q(){let t=this.P(E);if(this.O(V).forEach((t=>{!this.ei(t,Math.sign(t.dx),0)&&this.ei(t,4*Math.sign(t.dx),1)||(t.dx*=-1)})),t&&0===t.Jt){this.Z.filter((t=>t instanceof U)).forEach((i=>{void 0===i.Pt&&_(i,t)&&(i.Pt=.3,i.dy=-8,this.$t?.vt())})),this.Z.filter((t=>t instanceof Y)).forEach((i=>{if(_(i.Dt,t.Dt)){if(0===this.$t.width){t.remove();let i=this.J(D);i.x=t.x,i.y=t.y,this.$t.Yt=2}t.J(F,{name:"fx_flash"}),f.play("damage"),t.Jt=.6,t.dy=-32,0===t.dx?t.dx=6.4:t.dx=8*-Math.sign(t.dx)*.8;for(let i=0;i<this.$t.width;i++){let s=this.J(G);s.x=t.x,s.y=t.y,s.dx=8*Math.sin(i/this.$t.width*Math.PI*2),s.dy=80*Math.cos(i/this.$t.width*Math.PI*2),s.Ht=5}this.$t.width=0}}))}if(t&&void 0===t.Xt){let i=this.ei(t,0,2),s=this.ai(t,1,-1)?void 0:this.ai(t,1,0),n=this.ai(t,-1,-1)?void 0:this.ai(t,-1,0);i||(t.qt&&Array.isArray(s)?(t.Xt=.2,t.x=s[0],t.y=s[1]):t.zt&&Array.isArray(n)&&(t.Xt=-.2,t.x=n[0]+4,t.y=n[1]))}if(t&&!t.Xt&&void 0===t.Zt){let i=this.ai(t,1,-4)?void 0:this.ai(t,1,0),s=this.ai(t,-1,-4)?void 0:this.ai(t,-1,0);t.qt&&Array.isArray(i)?(t.Zt=.16,t.x=i[0],t.y=i[1]-1):t.zt&&Array.isArray(s)&&(t.Zt=-.16,t.x=s[0]+4,t.y=s[1]-1)}if(this.Z.filter((t=>t instanceof Q)).forEach((t=>{let i=this.ai(t,0,0);if(void 0!==t.Xt)return t.Xt=A(t.Xt,0,e.W),void(0===t.Xt&&(t.Xt=void 0,t.y=i[1]-4,t.dy=0));if(void 0!==t.Zt)return t.Zt=A(t.Zt,0,e.W),void(0===t.Zt&&(t.Zt=void 0,t.y=i[1]-4,t.dy=0));let s=4*t.Wt,n=0;{let i=Math.abs(t.dy),h=Math.sign(t.dy);for(let a=0;a<i;a+=1){let r=.5*h*Math.sqrt(e.W);if(this.ei(t,0,r)){t.kt=h,t.dy/=2,n=0;break}t.kt=0,t.y+=r,n=1-h*(a/i);{let i=t.Rt*s*Math.sqrt(n),h=1;t.dy+=h*i*e.W}}}{let i=3*s,n=1;for(let s=0;s<i;s+=1){let i=.5*n*Math.sqrt(e.W);if(this.ei(t,0,i)){t.kt=n,t.dy=0;break}t.kt=0,t.y+=i}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),n=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(e.W)*n;if(this.ei(t,i,0)){t.yt=s,t.dx=0;break}t.yt=0,t.x+=i}}})),t&&(this.si<t.x-4-1&&(this.si=t.x-4-1),this.si>t.x+4+1&&(this.si=t.x+4+1),this.ni<t.y-8&&(this.ni=t.y-8),this.ni>t.y+8&&(this.ni=t.y+8)),t){let i=t.dx<0?-50:t.dx>0?-10:-32;this.ti=A(this.ti,this.si+i,50*e.W),this.ii=this.ni-32,this.ti=Math.min(Math.max(0,this.ti),this.hi)}else this.ti=A(this.ti,this.ti+8*Math.sin(9*this.X),8*e.W),this.ii=A(this.ii,this.ii+8*Math.cos(9*this.X),8*e.W);this.Z.filter((t=>t instanceof W)).forEach((t=>{{let i=Math.abs(t.dy),s=Math.sign(t.dy);for(let n=0;n<i;n+=1){let i=.5*s*Math.sqrt(e.W);if(this.ei(t,0,i)){t.dy/=2;break}t.y+=i;{let i=1,s=1;t.dy+=s*i*e.W}}}{let i=Math.abs(t.dx),s=Math.sign(t.dx),n=1;for(let h=0;h<i;h+=1){let i=.5*s*Math.sqrt(e.W)*n;if(this.ei(t,i,0)){t.dx=0;let i=this.K(M);i.x=t.x-2*s,i.y=t.y,i.U.et=s,this.remove(t);break}t.x+=i}}}));let i=this.P(v);i&&t&&(i.x=A(i.x,t.x+4*Math.cos(8*t.X),26*e.W),i.y=A(i.y,t.y-8+8*Math.sin(8*t.X),26*e.W),Math.abs(i.x-t.x)+Math.abs(i.y-t.y)<=16?i.U.ct("idle"):i.U.ct("run"),i.U.et=t.U.et)}tt(t){t.M(-this.ti,-this.ii);for(let i=0;i<this.l.length;i++){let s=this.l[i];for(let n=0;n<s.length;n++){let h=s[n];t.D(h,4*n,4*i)}}}it(t){t.pop()}}const y=[0,1,2,3,4,5,20,21,22,23,24,40,41,42,44,60,61,62,63,64,80,81,82,83],b=t=>y.includes(t);!function(t){let i=function(t,i,s=!0){let n=document.createElement("canvas");s&&n.classList.add("pixelated");let e=n.getContext("2d");const a=()=>{n.width=t,n.height=i,e.imageSmoothingEnabled=s};return document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),a(),new h(n,e)}(64,64,!0);t.appendChild(i.canvas),p(i)}(document.getElementById("app"));
